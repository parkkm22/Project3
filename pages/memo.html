<!DOCTYPE html> 
 <html> 
 <head> 
 Â  Â  <meta charset="UTF-8"> 
 Â  Â  <title>Leaflet | Advanced DXF Viewer</title> 
 Â  Â Â  
 Â  Â  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" /> 
 Â  Â Â  
 Â  Â  <!-- Supabase JavaScript í´ë¼ì´ì–¸íŠ¸ --> 
 Â  Â  <script src="https://unpkg.com/@supabase/supabase-js@2"></script> 
 Â  Â Â  
 Â  Â  <!-- Supabase ì—°ê²° ì„¤ì • --> 
 Â  Â  <script> 
 Â  Â  Â  Â  // Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” 
 Â  Â  Â  Â  const supabaseUrl = 'https://txlkfywysdnoigcwbags.supabase.co'; 
 Â  Â  Â  Â  const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR4bGtmeXd5c2Rub2lnY3diYWdzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM2MTU4NDEsImV4cCI6MjA2OTE5MTg0MX0.svkW2EFuqUTfomf8_FDRhdghfCC5_NbmF1zEXhI3TD0'; 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // supabase ê°ì²´ê°€ ë¡œë“œë  ë•Œê¹Œì§€ ëŒ€ê¸° 
 Â  Â  Â  Â  window.addEventListener('load', function() { 
 Â  Â  Â  Â  Â  Â  if (typeof supabase !== 'undefined') { 
 Â  Â  Â  Â  Â  Â  Â  Â  window.supabaseClient = supabase.createClient(supabaseUrl, supabaseKey); 
 Â  Â  Â  Â  Â  Â  Â  Â  console.log('ğŸš€ Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” ì™„ë£Œ'); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // ì—°ê²° í…ŒìŠ¤íŠ¸ 
 Â  Â  Â  Â  Â  Â  Â  Â  window.supabaseClient.table('blasting_locations').select('count').execute() 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .then(response => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('âœ… Supabase ì—°ê²° í…ŒìŠ¤íŠ¸ ì„±ê³µ:', response); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }) 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .catch(error => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('âŒ Supabase ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:', error); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }); 
 Â  Â  Â  Â  Â  Â  } else { 
 Â  Â  Â  Â  Â  Â  Â  Â  console.error('âŒ Supabase ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë˜ì§€ ì•ŠìŒ'); 
 Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  }); 
 Â  Â  </script> 
 Â  Â Â  
 Â  Â  <style> 
 Â  Â  Â  Â  html, body, #map { margin: 0; height: 100%; width: 100%; overflow: hidden; } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  /* ì¢Œì¸¡ ë©”ì¸ ì»¨íŠ¸ë¡¤ íŒ¨ë„ */ 
 Â  Â  Â  Â  .main-control-panel { 
 Â  Â  Â  Â  Â  Â  position: absolute; 
 Â  Â  Â  Â  Â  Â  top: 0; 
 Â  Â  Â  Â  Â  Â  left: 0; 
 Â  Â  Â  Â  Â  Â  width: 320px; 
 Â  Â  Â  Â  Â  Â  height: 100%; 
 Â  Â  Â  Â  Â  Â  background: rgba(255, 255, 255, 0.98); 
 Â  Â  Â  Â  Â  Â  border-right: 2px solid #e0e0e0; 
 Â  Â  Â  Â  Â  Â  z-index: 1000; 
 Â  Â  Â  Â  Â  Â  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
 Â  Â  Â  Â  Â  Â  box-shadow: 2px 0 10px rgba(0,0,0,0.1); 
 Â  Â  Â  Â  Â  Â  overflow-y: auto; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  .main-control-panel h3 { 
 Â  Â  Â  Â  Â  Â  margin: 0; 
 Â  Â  Â  Â  Â  Â  padding: 20px 20px 15px 20px; 
 Â  Â  Â  Â  Â  Â  color: #333; 
 Â  Â  Â  Â  Â  Â  font-size: 18px; 
 Â  Â  Â  Â  Â  Â  border-bottom: 2px solid #007bff; 
 Â  Â  Â  Â  Â  Â  background: #f8f9fa; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  .control-section { 
 Â  Â  Â  Â  Â  Â  padding: 15px 20px; 
 Â  Â  Â  Â  Â  Â  border-bottom: 1px solid #eee; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  .control-section h4 { 
 Â  Â  Â  Â  Â  Â  margin: 0 0 12px 0; 
 Â  Â  Â  Â  Â  Â  color: #007bff; 
 Â  Â  Â  Â  Â  Â  font-size: 14px; 
 Â  Â  Â  Â  Â  Â  font-weight: 600; 
 Â  Â  Â  Â  Â  Â  display: flex; 
 Â  Â  Â  Â  Â  Â  align-items: center; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  .control-section h4 i { 
 Â  Â  Â  Â  Â  Â  margin-right: 8px; 
 Â  Â  Â  Â  Â  Â  font-size: 16px; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  .file-upload-section { 
 Â  Â  Â  Â  Â  Â  background: #f8f9fa; 
 Â  Â  Â  Â  Â  Â  border-radius: 8px; 
 Â  Â  Â  Â  Â  Â  padding: 15px; 
 Â  Â  Â  Â  Â  Â  margin: 10px 0; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  .file-upload-section input[type="file"] { 
 Â  Â  Â  Â  Â  Â  width: 100%; 
 Â  Â  Â  Â  Â  Â  padding: 8px; 
 Â  Â  Â  Â  Â  Â  border: 2px dashed #007bff; 
 Â  Â  Â  Â  Â  Â  border-radius: 6px; 
 Â  Â  Â  Â  Â  Â  background: white; 
 Â  Â  Â  Â  Â  Â  font-size: 12px; 
 Â  Â  Â  Â  Â  Â  cursor: pointer; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  .file-upload-section input[type="file"]:hover { 
 Â  Â  Â  Â  Â  Â  border-color: #0056b3; 
 Â  Â  Â  Â  Â  Â  background: #f0f8ff; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  #status { 
 Â  Â  Â  Â  Â  Â  margin-top: 10px; 
 Â  Â  Â  Â  Â  Â  padding: 8px 12px; 
 Â  Â  Â  Â  Â  Â  background: #e7f3ff; 
 Â  Â  Â  Â  Â  Â  border-left: 4px solid #007bff; 
 Â  Â  Â  Â  Â  Â  border-radius: 4px; 
 Â  Â  Â  Â  Â  Â  font-size: 12px; 
 Â  Â  Â  Â  Â  Â  color: #0056b3; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  #layer-control { 
 Â  Â  Â  Â  Â  Â  max-height: 300px; 
 Â  Â  Â  Â  Â  Â  overflow-y: auto; 
 Â  Â  Â  Â  Â  Â  background: white; 
 Â  Â  Â  Â  Â  Â  border: 1px solid #e0e0e0; 
 Â  Â  Â  Â  Â  Â  border-radius: 6px; 
 Â  Â  Â  Â  Â  Â  padding: 10px; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  .layer-item { 
 Â  Â  Â  Â  Â  Â  display: flex; 
 Â  Â  Â  Â  Â  Â  align-items: center; 
 Â  Â  Â  Â  Â  Â  padding: 8px 0; 
 Â  Â  Â  Â  Â  Â  border-bottom: 1px solid #f0f0f0; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  .layer-item:last-child { 
 Â  Â  Â  Â  Â  Â  border-bottom: none; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  .layer-item input[type="checkbox"] { 
 Â  Â  Â  Â  Â  Â  margin-right: 10px; 
 Â  Â  Â  Â  Â  Â  transform: scale(1.2); 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  .layer-item label { 
 Â  Â  Â  Â  Â  Â  flex: 1; 
 Â  Â  Â  Â  Â  Â  font-size: 12px; 
 Â  Â  Â  Â  Â  Â  color: #333; 
 Â  Â  Â  Â  Â  Â  cursor: pointer; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  .layer-opacity { 
 Â  Â  Â  Â  Â  Â  width: 60px; 
 Â  Â  Â  Â  Â  Â  height: 20px; 
 Â  Â  Â  Â  Â  Â  margin-left: 10px; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  /* ë„êµ¬ íŒ¨ë„ ìŠ¤íƒ€ì¼ */ 
 Â  Â  Â  Â  .tools-panel { 
 Â  Â  Â  Â  Â  Â  position: absolute; 
 Â  Â  Â  Â  Â  Â  top: 20px; 
 Â  Â  Â  Â  Â  Â  right: 20px; 
 Â  Â  Â  Â  Â  Â  background: rgba(255, 255, 255, 0.98); 
 Â  Â  Â  Â  Â  Â  padding: 20px; 
 Â  Â  Â  Â  Â  Â  border-radius: 12px; 
 Â  Â  Â  Â  Â  Â  border: 2px solid #e0e0e0; 
 Â  Â  Â  Â  Â  Â  z-index: 1000; 
 Â  Â  Â  Â  Â  Â  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
 Â  Â  Â  Â  Â  Â  box-shadow: 0 6px 20px rgba(0,0,0,0.15); 
 Â  Â  Â  Â  Â  Â  min-width: 180px; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  .tools-panel h4 { 
 Â  Â  Â  Â  Â  Â  margin: 0 0 15px 0; 
 Â  Â  Â  Â  Â  Â  color: #333; 
 Â  Â  Â  Â  Â  Â  font-size: 14px; 
 Â  Â  Â  Â  Â  Â  text-align: center; 
 Â  Â  Â  Â  Â  Â  font-weight: 600; 
 Â  Â  Â  Â  Â  Â  border-bottom: 2px solid #007bff; 
 Â  Â  Â  Â  Â  Â  padding-bottom: 8px; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  .tool-button { 
 Â  Â  Â  Â  Â  Â  display: block; 
 Â  Â  Â  Â  Â  Â  width: 100%; 
 Â  Â  Â  Â  Â  Â  padding: 12px 15px; 
 Â  Â  Â  Â  Â  Â  margin: 8px 0; 
 Â  Â  Â  Â  Â  Â  background: white; 
 Â  Â  Â  Â  Â  Â  border: 2px solid #e0e0e0; 
 Â  Â  Â  Â  Â  Â  border-radius: 8px; 
 Â  Â  Â  Â  Â  Â  cursor: pointer; 
 Â  Â  Â  Â  Â  Â  transition: all 0.3s ease; 
 Â  Â  Â  Â  Â  Â  text-align: center; 
 Â  Â  Â  Â  Â  Â  font-size: 13px; 
 Â  Â  Â  Â  Â  Â  font-weight: 500; 
 Â  Â  Â  Â  Â  Â  color: #555; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  .tool-button:hover { 
 Â  Â  Â  Â  Â  Â  background: #007bff; 
 Â  Â  Â  Â  Â  Â  color: white; 
 Â  Â  Â  Â  Â  Â  border-color: #007bff; 
 Â  Â  Â  Â  Â  Â  transform: translateY(-2px); 
 Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 12px rgba(0,123,255,0.3); 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  .tool-button.active { 
 Â  Â  Â  Â  Â  Â  background: #007bff; 
 Â  Â  Â  Â  Â  Â  color: white; 
 Â  Â  Â  Â  Â  Â  border-color: #007bff; 
 Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 12px rgba(0,123,255,0.3); 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  .tool-button i { 
 Â  Â  Â  Â  Â  Â  display: block; 
 Â  Â  Â  Â  Â  Â  font-size: 24px; 
 Â  Â  Â  Â  Â  Â  margin-bottom: 5px; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */ 
 Â  Â  Â  Â  .modal { 
 Â  Â  Â  Â  Â  Â  display: none; 
 Â  Â  Â  Â  Â  Â  position: fixed; 
 Â  Â  Â  Â  Â  Â  z-index: 2000; 
 Â  Â  Â  Â  Â  Â  left: 0; 
 Â  Â  Â  Â  Â  Â  top: 0; 
 Â  Â  Â  Â  Â  Â  width: 100%; 
 Â  Â  Â  Â  Â  Â  height: 100%; 
 Â  Â  Â  Â  Â  Â  background-color: rgba(0,0,0,0.5); 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  .modal-content { 
 Â  Â  Â  Â  Â  Â  background-color: white; 
 Â  Â  Â  Â  Â  Â  margin: 15% auto; 
 Â  Â  Â  Â  Â  Â  padding: 20px; 
 Â  Â  Â  Â  Â  Â  border-radius: 8px; 
 Â  Â  Â  Â  Â  Â  width: 80%; 
 Â  Â  Â  Â  Â  Â  max-width: 400px; 
 Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 8px rgba(0,0,0,0.2); 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  .modal-header { 
 Â  Â  Â  Â  Â  Â  display: flex; 
 Â  Â  Â  Â  Â  Â  justify-content: space-between; 
 Â  Â  Â  Â  Â  Â  align-items: center; 
 Â  Â  Â  Â  Â  Â  margin-bottom: 20px; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  .modal-title { 
 Â  Â  Â  Â  Â  Â  font-size: 18px; 
 Â  Â  Â  Â  Â  Â  font-weight: bold; 
 Â  Â  Â  Â  Â  Â  color: #007bff; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  .close { 
 Â  Â  Â  Â  Â  Â  color: #aaa; 
 Â  Â  Â  Â  Â  Â  font-size: 28px; 
 Â  Â  Â  Â  Â  Â  font-weight: bold; 
 Â  Â  Â  Â  Â  Â  cursor: pointer; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  .close:hover { 
 Â  Â  Â  Â  Â  Â  color: #000; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  .form-group { 
 Â  Â  Â  Â  Â  Â  margin-bottom: 15px; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  .form-group label { 
 Â  Â  Â  Â  Â  Â  display: block; 
 Â  Â  Â  Â  Â  Â  margin-bottom: 5px; 
 Â  Â  Â  Â  Â  Â  font-weight: bold; 
 Â  Â  Â  Â  Â  Â  color: #333; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  .form-group input, .form-group textarea { 
 Â  Â  Â  Â  Â  Â  width: 100%; 
 Â  Â  Â  Â  Â  Â  padding: 8px; 
 Â  Â  Â  Â  Â  Â  border: 1px solid #ddd; 
 Â  Â  Â  Â  Â  Â  border-radius: 4px; 
 Â  Â  Â  Â  Â  Â  font-size: 14px; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  .form-group textarea { 
 Â  Â  Â  Â  Â  Â  height: 80px; 
 Â  Â  Â  Â  Â  Â  resize: vertical; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  .btn { 
 Â  Â  Â  Â  Â  Â  background: #007bff; 
 Â  Â  Â  Â  Â  Â  color: white; 
 Â  Â  Â  Â  Â  Â  padding: 10px 20px; 
 Â  Â  Â  Â  Â  Â  border: none; 
 Â  Â  Â  Â  Â  Â  border-radius: 4px; 
 Â  Â  Â  Â  Â  Â  cursor: pointer; 
 Â  Â  Â  Â  Â  Â  font-size: 14px; 
 Â  Â  Â  Â  Â  Â  margin-right: 10px; 
 Â  Â  Â  Â  Â  Â  transition: all 0.3s ease; 
 Â  Â  Â  Â  Â  Â  font-weight: 500; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  .btn:hover { 
 Â  Â  Â  Â  Â  Â  background: #0056b3; 
 Â  Â  Â  Â  Â  Â  transform: translateY(-1px); 
 Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 8px rgba(0,123,255,0.3); 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  .btn:active { 
 Â  Â  Â  Â  Â  Â  transform: translateY(0); 
 Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 4px rgba(0,123,255,0.3); 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  .btn-secondary { 
 Â  Â  Â  Â  Â  Â  background: #6c757d; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  .btn-secondary:hover { 
 Â  Â  Â  Â  Â  Â  background: #545b62; 
 Â  Â  Â  Â  Â  Â  transform: translateY(-1px); 
 Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 8px rgba(108,117,125,0.3); 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  .btn-secondary:active { 
 Â  Â  Â  Â  Â  Â  transform: translateY(0); 
 Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 4px rgba(108,117,125,0.3); 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  /* ëª¨ë‹¬ ë²„íŠ¼ ì˜ì—­ ê°œì„  */ 
 Â  Â  Â  Â  .modal-content .btn { 
 Â  Â  Â  Â  Â  Â  min-width: 80px; 
 Â  Â  Â  Â  Â  Â  height: 40px; 
 Â  Â  Â  Â  Â  Â  display: inline-flex; 
 Â  Â  Â  Â  Â  Â  align-items: center; 
 Â  Â  Â  Â  Â  Â  justify-content: center; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  /* ë²„íŠ¼ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ */ 
 Â  Â  Â  Â  .button-container { 
 Â  Â  Â  Â  Â  Â  display: flex; 
 Â  Â  Â  Â  Â  Â  justify-content: flex-end; 
 Â  Â  Â  Â  Â  Â  gap: 10px; 
 Â  Â  Â  Â  Â  Â  margin-top: 25px; 
 Â  Â  Â  Â  Â  Â  padding-top: 20px; 
 Â  Â  Â  Â  Â  Â  border-top: 1px solid #e9ecef; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  .button-container .btn { 
 Â  Â  Â  Â  Â  Â  min-width: 90px; 
 Â  Â  Â  Â  Â  Â  height: 42px; 
 Â  Â  Â  Â  Â  Â  font-size: 14px; 
 Â  Â  Â  Â  Â  Â  font-weight: 600; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  .btn-primary { 
 Â  Â  Â  Â  Â  Â  background: #007bff; 
 Â  Â  Â  Â  Â  Â  color: white; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  .btn-primary:hover { 
 Â  Â  Â  Â  Â  Â  background: #0056b3; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  /* ëª¨ë‹¬ ë‚´ìš© ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•˜ë„ë¡ */ 
 Â  Â  Â  Â  .modal-content { 
 Â  Â  Â  Â  Â  Â  max-height: 85vh; 
 Â  Â  Â  Â  Â  Â  overflow-y: auto; 
 Â  Â  Â  Â  Â  Â  padding-bottom: 20px; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  /* í¼ ê·¸ë£¹ ê°„ê²© ì¡°ì • */ 
 Â  Â  Â  Â  .form-group { 
 Â  Â  Â  Â  Â  Â  margin-bottom: 15px; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  .form-group:last-of-type { 
 Â  Â  Â  Â  Â  Â  margin-bottom: 10px; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  /* ëª¨ë‹¬ í¬ê¸° ì¡°ì • */ 
 Â  Â  Â  Â  .modal { 
 Â  Â  Â  Â  Â  Â  display: none; 
 Â  Â  Â  Â  Â  Â  position: fixed; 
 Â  Â  Â  Â  Â  Â  z-index: 2000; 
 Â  Â  Â  Â  Â  Â  left: 0; 
 Â  Â  Â  Â  Â  Â  top: 0; 
 Â  Â  Â  Â  Â  Â  width: 100%; 
 Â  Â  Â  Â  Â  Â  height: 100%; 
 Â  Â  Â  Â  Â  Â  background-color: rgba(0,0,0,0.5); 
 Â  Â  Â  Â  Â  Â  overflow-y: auto; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  .modal-content { 
 Â  Â  Â  Â  Â  Â  background-color: white; 
 Â  Â  Â  Â  Â  Â  margin: 5% auto; 
 Â  Â  Â  Â  Â  Â  padding: 25px; 
 Â  Â  Â  Â  Â  Â  border-radius: 8px; 
 Â  Â  Â  Â  Â  Â  width: 90%; 
 Â  Â  Â  Â  Â  Â  max-width: 500px; 
 Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 8px rgba(0,0,0,0.2); 
 Â  Â  Â  Â  Â  Â  position: relative; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  /* ë²„íŠ¼ ì»¨í…Œì´ë„ˆê°€ í•­ìƒ ë³´ì´ë„ë¡ */ 
 Â  Â  Â  Â  .button-container { 
 Â  Â  Â  Â  Â  Â  position: sticky; 
 Â  Â  Â  Â  Â  Â  bottom: 0; 
 Â  Â  Â  Â  Â  Â  background: white; 
 Â  Â  Â  Â  Â  Â  padding: 15px 0; 
 Â  Â  Â  Â  Â  Â  margin-top: 20px; 
 Â  Â  Â  Â  Â  Â  border-top: 1px solid #e9ecef; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  /* ëª¨ë‹¬ ìµœëŒ€ ë†’ì´ ì œí•œ */ 
 Â  Â  Â  Â  #blasting-modal .modal-content, 
 Â  Â  Â  Â  #measurement-modal .modal-content { 
 Â  Â  Â  Â  Â  Â  max-height: 70vh; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  #location-modal .modal-content { 
 Â  Â  Â  Â  Â  Â  max-height: 75vh; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  /* ì…ë ¥ í•„ë“œ í¬ê¸° ì¡°ì • */ 
 Â  Â  Â  Â  .form-group input, 
 Â  Â  Â  Â  .form-group textarea { 
 Â  Â  Â  Â  Â  Â  padding: 6px 8px; 
 Â  Â  Â  Â  Â  Â  font-size: 13px; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  /* ë¼ë²¨ í¬ê¸° ì¡°ì • */ 
 Â  Â  Â  Â  .form-group label { 
 Â  Â  Â  Â  Â  Â  font-size: 13px; 
 Â  Â  Â  Â  Â  Â  margin-bottom: 4px; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  /* ëª¨ë‹¬ í—¤ë” ì¡°ì • */ 
 Â  Â  Â  Â  .modal-header { 
 Â  Â  Â  Â  Â  Â  padding-bottom: 15px; 
 Â  Â  Â  Â  Â  Â  margin-bottom: 15px; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  .modal-title { 
 Â  Â  Â  Â  Â  Â  font-size: 16px; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  /* íƒœê·¸ ê´€ë ¨ ìŠ¤íƒ€ì¼ */ 
 Â  Â  Â  Â  .tag-preview { 
 Â  Â  Â  Â  Â  Â  transition: all 0.2s ease; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  .tag-preview:hover { 
 Â  Â  Â  Â  Â  Â  transform: scale(1.05); 
 Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 4px rgba(0,0,0,0.2); 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  /* íƒœê·¸ê°€ ìˆëŠ” ë§ˆì»¤ ìŠ¤íƒ€ì¼ */ 
 Â  Â  Â  Â  .location-marker-with-tags { 
 Â  Â  Â  Â  Â  Â  background: transparent !important; 
 Â  Â  Â  Â  Â  Â  border: none !important; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  .location-marker-with-tags .leaflet-marker-icon { 
 Â  Â  Â  Â  Â  Â  background: transparent !important; 
 Â  Â  Â  Â  Â  Â  border: none !important; 
 Â  Â  Â  Â  } 
 Â  Â  </style> 
 </head> 
 <body> 
 Â  Â  <div id="map"></div> 
 Â  
 Â  Â  Â <div class="main-control-panel"> 
 Â  Â  Â  Â  <h3>ë°œíŒŒ/ê³„ì¸¡ìœ„ì¹˜ ì •ë³´</h3> 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  <div class="control-section"> 
 Â  Â  Â  Â  Â  Â  <h4>ğŸ’¥ ë°œíŒŒìœ„ì¹˜ ì •ë³´</h4> 
 Â  Â  Â  Â  Â  Â  <div id="location-info" style="font-size: 12px; color: #666;"> 
 Â  Â  Â  Â  Â  Â  Â  Â  ì§€ë„ì—ì„œ ë°œíŒŒ ìœ„ì¹˜ë¥¼ ì¶”ê°€í•˜ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤. 
 Â  Â  Â  Â  Â  Â  </div> 
 Â  Â  Â  Â  </div> 

 Â  Â  </div> 
 Â  Â  Â  
 Â  Â  Â <!-- ë„êµ¬ íŒ¨ë„ --> 
 Â  Â  Â <div class="tools-panel"> 
 Â  Â  Â  Â  <h4>ğŸ› ï¸ ë„êµ¬</h4> 
 Â  Â  Â  Â  <button class="tool-button" id="add-location-btn"> 
 Â  Â  Â  Â  Â  Â  <i>ğŸ“</i> 
 Â  Â  Â  Â  Â  Â  ìœ„ì¹˜ ì¶”ê°€ 
 Â  Â  Â  Â  </button> 
 Â  Â  Â  Â  <button class="tool-button" id="add-blasting-btn"> 
 Â  Â  Â  Â  Â  Â  <i>ğŸ’¥</i> 
 Â  Â  Â  Â  Â  Â  ë°œíŒŒ ìœ„ì¹˜ 
 Â  Â  Â  Â  </button> 
 Â  Â  Â  Â  <button class="tool-button" id="add-measurement-btn"> 
 Â  Â  Â  Â  Â  Â  <i>ğŸ“Š</i> 
 Â  Â  Â  Â  Â  Â  ê³„ì¸¡ ìœ„ì¹˜ 
 Â  Â  Â  Â  </button> 
 Â  Â  Â  Â  <button class="tool-button" id="measure-distance-btn"> 
 Â  Â  Â  Â  Â  Â  <i>ğŸ“</i> 
 Â  Â  Â  Â  Â  Â  ê±°ë¦¬ ê³„ì‚° 
 Â  Â  Â  Â  </button> 
 Â  Â  Â  Â  <button class="tool-button" id="clear-all-btn"> 
 Â  Â  Â  Â  Â  Â  <i>ğŸ—‘ï¸</i> 
 Â  Â  Â  Â  Â  Â  ì „ì²´ ì‚­ì œ 
 Â  Â  Â  Â  </button> 

 Â  Â  </div> 
 Â  Â Â  
 Â  Â  <!-- ìœ„ì¹˜ ì¶”ê°€ ëª¨ë‹¬ --> 
 Â  Â  <div id="location-modal" class="modal"> 
 Â  Â  Â  Â  <div class="modal-content"> 
 Â  Â  Â  Â  Â  Â  <div class="modal-header"> 
 Â  Â  Â  Â  Â  Â  Â  Â  <span class="modal-title">ìœ„ì¹˜ ì •ë³´ ì¶”ê°€</span> 
 Â  Â  Â  Â  Â  Â  Â  Â  <span class="close" id="close-location-modal">&times;</span> 
 Â  Â  Â  Â  Â  Â  </div> 
 Â  Â  Â  Â  Â  Â  <form id="location-form"> 
 Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="location-name">ìœ„ì¹˜ëª…</label> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="location-name" name="location-name" placeholder="ìœ„ì¹˜ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" required> 
 Â  Â  Â  Â  Â  Â  Â  Â  </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="location-description">ì„¤ëª…</label> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="location-description" name="location-description" placeholder="ìœ„ì¹˜ì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" style="height: 60px;"></textarea> 
 Â  Â  Â  Â  Â  Â  Â  Â  </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="location-category">ì¹´í…Œê³ ë¦¬</label> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="location-category" name="location-category" placeholder="ì¹´í…Œê³ ë¦¬ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ê±´ë¬¼, ì‹œì„¤ë¬¼, ê´€ì‹¬ì§€ì )"> 
 Â  Â  Â  Â  Â  Â  Â  Â  </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="location-tags">íƒœê·¸</label> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="location-tags" name="location-tags" placeholder="íƒœê·¸ë¥¼ ì‰¼í‘œë¡œ êµ¬ë¶„í•˜ì—¬ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ê±´ì„¤ì¤‘, ì¤‘ìš”, ì ê²€í•„ìš”)"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="tags-preview" style="margin-top: 8px; min-height: 20px;"></div> 
 Â  Â  Â  Â  Â  Â  Â  Â  </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  <div class="button-container"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" class="btn btn-secondary" id="cancel-location">ì·¨ì†Œ</button> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" class="btn btn-primary" id="save-location">ì €ì¥</button> 
 Â  Â  Â  Â  Â  Â  Â  Â  </div> 
 Â  Â  Â  Â  Â  Â  </form> 
 Â  Â  Â  Â  </div> 
 Â  Â  </div> 

 Â  Â  <!-- ë°œíŒŒ ì •ë³´ ëª¨ë‹¬ --> 
 Â  Â  <div id="blasting-modal" class="modal"> 
 Â  Â  Â  Â  <div class="modal-content"> 
 Â  Â  Â  Â  Â  Â  <div class="modal-header"> 
 Â  Â  Â  Â  Â  Â  Â  Â  <span class="modal-title">ë°œíŒŒ ì •ë³´ ì…ë ¥</span> 
 Â  Â  Â  Â  Â  Â  Â  Â  <span class="close" id="close-blasting-modal">&times;</span> 
 Â  Â  Â  Â  Â  Â  </div> 
 Â  Â  Â  Â  Â  Â  <form id="blasting-form"> 
 Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label>Station ê³„ì‚° ë°©ì‹</label> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="background: #e7f3ff; padding: 6px; border-radius: 4px; border-left: 3px solid #007bff; font-size: 11px; color: #0056b3;"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  âœ… ê¸°ì¤€ì  ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ìë™ ê³„ì‚°ë©ë‹ˆë‹¤.<br> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ“ ì§€ë„ì—ì„œ í´ë¦­í•˜ë©´ ì •í™•í•œ STA ê°’ì´ ìë™ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤. 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="blasting-sta">ë°œíŒŒìœ„ì¹˜(Sta.)</label> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="blasting-sta" name="blasting-sta" placeholder="ìë™ ê³„ì‚°ë¨" readonly> 
 Â  Â  Â  Â  Â  Â  Â  Â  </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="blasting-coordinates">ë°œíŒŒì¢Œí‘œ(X,Y) - EPSG:5186</label> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="blasting-coordinates" name="blasting-coordinates" placeholder="ìë™ ê³„ì‚°ë¨" readonly> 
 Â  Â  Â  Â  Â  Â  Â  Â  </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="blasting-depth">ê¹Šì´(m)</label> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="blasting-depth" name="blasting-depth" placeholder="ë°œíŒŒ ê¹Šì´ë¥¼ ì…ë ¥í•˜ì„¸ìš”" step="0.1" min="0" required> 
 Â  Â  Â  Â  Â  Â  Â  Â  </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="blasting-description">ì„¤ëª…</label> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="blasting-description" name="blasting-description" placeholder="ë°œíŒŒ ì‘ì—…ì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" style="height: 60px;"></textarea> 
 Â  Â  Â  Â  Â  Â  Â  Â  </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  <div class="button-container"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" class="btn btn-secondary" id="cancel-blasting">ì·¨ì†Œ</button> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" class="btn btn-primary" id="save-blasting">ì €ì¥</button> 
 Â  Â  Â  Â  Â  Â  Â  Â  </div> 
 Â  Â  Â  Â  Â  Â  </form> 
 Â  Â  Â  Â  </div> 
 Â  Â  </div> 

 Â  Â  <!-- ê³„ì¸¡ ì •ë³´ ëª¨ë‹¬ --> 
 Â  Â  <div id="measurement-modal" class="modal"> 
 Â  Â  Â  Â  <div class="modal-content"> 
 Â  Â  Â  Â  Â  Â  <div class="modal-header"> 
 Â  Â  Â  Â  Â  Â  Â  Â  <span class="modal-title">ê³„ì¸¡ ì •ë³´ ì…ë ¥</span> 
 Â  Â  Â  Â  Â  Â  Â  Â  <span class="close" id="close-measurement-modal">&times;</span> 
 Â  Â  Â  Â  Â  Â  </div> 
 Â  Â  Â  Â  Â  Â  <form id="measurement-form"> 
 Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="measurement-sta">ê³„ì¸¡ìœ„ì¹˜(Sta.)</label> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="measurement-sta" name="measurement-sta" placeholder="ìë™ ê³„ì‚°ë¨" readonly> 
 Â  Â  Â  Â  Â  Â  Â  Â  </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="measurement-coordinates">ê³„ì¸¡ì¢Œí‘œ(X,Y) - EPSG:5186</label> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="measurement-coordinates" name="measurement-coordinates" placeholder="ìë™ ê³„ì‚°ë¨" readonly> 
 Â  Â  Â  Â  Â  Â  Â  Â  </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="measurement-description">ì„¤ëª…</label> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="measurement-description" name="measurement-description" placeholder="ê³„ì¸¡ ì‘ì—…ì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" style="height: 60px;"></textarea> 
 Â  Â  Â  Â  Â  Â  Â  Â  </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  <div class="button-container"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" class="btn btn-secondary" id="cancel-measurement">ì·¨ì†Œ</button> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" class="btn btn-primary" id="save-measurement">ì €ì¥</button> 
 Â  Â  Â  Â  Â  Â  Â  Â  </div> 
 Â  Â  Â  Â  Â  Â  </form> 
 Â  Â  Â  Â  </div> 
 Â  Â  </div> 
 Â  
 Â  Â  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script> 
 Â  Â  <script src="https://unpkg.com/proj4@2.11.0/dist/proj4.js"></script> 
 Â  Â  <script src="https://unpkg.com/@turf/turf@6/turf.min.js"></script> 
 Â  Â  <!-- DXF íŒŒì„œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ --> 
 Â  Â  <script src="https://unpkg.com/dxf@4.7.0/dist/dxf.js"></script> 
 Â  Â  <!-- ë°±ì—…ìš© ê¸°ì¡´ íŒŒì„œ --> 
 Â  Â  <script src="https://unpkg.com/dxf-parser@1.1.2/dist/dxf-parser.js"></script> 

 Â  Â  <script> 
 Â  Â  Â  Â  // --- 1. ì„¤ì • ë° ì´ˆê¸°í™” --- 
 Â  Â  Â  Â  // Google ìœ„ì„±ì§€ë„ íƒ€ì¼ ì„œë¹„ìŠ¤ 
 Â  Â  Â  Â  const GOOGLE_SATELLITE_URL = 'https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}'; 
 Â  Â  Â  Â  const GOOGLE_HYBRID_URL = 'https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}'; 
 Â  Â  Â  Â  const ESRI_SATELLITE_URL = 'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}'; 

 Â  Â  Â  Â  proj4.defs("EPSG:5186", "+proj=tmerc +lat_0=38 +lon_0=127 +k=1 +x_0=200000 +y_0=600000 +ellps=GRS80 +units=m +no_defs"); 
 Â  Â  Â  Â  proj4.defs("EPSG:5179", "+proj=tmerc +lat_0=38 +lon_0=127.5 +k=1 +x_0=200000 +y_0=600000 +ellps=GRS80 +units=m +no_defs"); 

 Â  Â  Â  Â  const map = L.map('map', { center: [36.5, 127.5], zoom: 7, maxZoom: 25 }); 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // Google ìœ„ì„± ì´ë¯¸ì§€ (ê¸°ë³¸) 
 Â  Â  Â  Â  const googleLayer = L.tileLayer(GOOGLE_SATELLITE_URL, { 
 Â  Â  Â  Â  Â  Â  attribution: 'Google Satellite', 
 Â  Â  Â  Â  Â  Â  maxZoom: 25, 
 Â  Â  Â  Â  Â  Â  minZoom: 0 
 Â  Â  Â  Â  }); 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // Google í•˜ì´ë¸Œë¦¬ë“œ (ë¼ë²¨ í¬í•¨) 
 Â  Â  Â  Â  const googleHybridLayer = L.tileLayer(GOOGLE_HYBRID_URL, { 
 Â  Â  Â  Â  Â  Â  attribution: 'Google Hybrid', 
 Â  Â  Â  Â  Â  Â  maxZoom: 25, 
 Â  Â  Â  Â  Â  Â  minZoom: 0 
 Â  Â  Â  Â  }); 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // ESRI ìœ„ì„± ì´ë¯¸ì§€ (ë°±ì—…ìš©) 
 Â  Â  Â  Â  const esriLayer = L.tileLayer(ESRI_SATELLITE_URL, { 
 Â  Â  Â  Â  Â  Â  attribution: 'ESRI World Imagery', 
 Â  Â  Â  Â  Â  Â  maxZoom: 25, 
 Â  Â  Â  Â  Â  Â  minZoom: 0 
 Â  Â  Â  Â  }); 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // ì´ˆê¸° ë ˆì´ì–´ ì¶”ê°€ (Google ìœ„ì„±) 
 Â  Â  Â  Â  googleLayer.addTo(map); 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // í˜„ì¬ ë² ì´ìŠ¤ ë ˆì´ì–´ ì„¤ì • 
 Â  Â  Â  Â  let currentBaseLayer = googleLayer; 
 Â  
 Â  Â  Â  Â  const dxfLayerGroup = L.layerGroup().addTo(map); 
 Â  Â  Â  Â  const layerGroups = new Map(); // ë ˆì´ì–´ë³„ ê·¸ë£¹ ê´€ë¦¬ë¥¼ ìœ„í•œ Map 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // ë ˆì´ì–´ ê·¸ë£¹ì„ ë² ì´ìŠ¤ ë ˆì´ì–´ ìœ„ì— ì¶”ê°€í•˜ê¸° ìœ„í•œ í•¨ìˆ˜ 
 Â  Â  Â  Â  function addDXFLayerToMap() { 
 Â  Â  Â  Â  Â  Â  if (map.hasLayer(dxfLayerGroup)) { 
 Â  Â  Â  Â  Â  Â  Â  Â  map.removeLayer(dxfLayerGroup); 
 Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  map.addLayer(dxfLayerGroup); 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // ë„êµ¬ ê´€ë ¨ ë³€ìˆ˜ë“¤ 
 Â  Â  Â  Â  let isAddingLocation = false; 
 Â  Â  Â  Â  let isMeasuringDistance = false; 
 Â  Â  Â  Â  let isAddingBlasting = false; 
 Â  Â  Â  Â  let isAddingMeasurement = false; 
 Â  Â  Â  Â  let locationMarkers = []; 
 Â  Â  Â  Â  let distanceMarkers = []; 
 Â  Â  Â  Â  let distancePolylines = []; 
 Â  Â  Â  Â  let currentDistancePoints = []; 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // ë°œíŒŒ ê´€ë ¨ ë³€ìˆ˜ë“¤ 
 Â  Â  Â  Â  let blastingMarkers = []; 
 Â  Â  Â  Â  let measurementMarkers = []; 
 Â  Â  Â  Â  let routeData = null; // GeoJSON ë…¸ì„  ë°ì´í„° 
 Â  Â  Â  Â  let routeLayer = null; // ë…¸ì„  ë ˆì´ì–´ 
 Â  Â  Â  Â Â  

 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // ê¸°ì¤€ì  ë°ì´í„° (QGISì—ì„œ ìƒì„±ëœ ì •í™•í•œ ì¢Œí‘œ-STA ìŒ) 
 Â  Â  Â  Â  const referencePoints = [ 
 Â  Â  Â  Â  Â  Â  { x: 191210.1879, y: 545380.3588, sta: 27135.5 },Â  Â  // 27km135.5 
 Â  Â  Â  Â  Â  Â  { x: 191786.3363, y: 544295.5358, sta: 25906.904 },Â  // 25km906.904 
 Â  Â  Â  Â  Â  Â  { x: 191848.1417, y: 544171.445, sta: 25798.249 },Â  Â // 25km798.249 
 Â  Â  Â  Â  Â  Â  { x: 191876.4512, y: 544101.7818, sta: 25693.038 },Â  // 25km693.038 
 Â  Â  Â  Â  Â  Â  { x: 191942.2975, y: 543890.4457, sta: 25471.646 },Â  // 25km471.646 
 Â  Â  Â  Â  Â  Â  { x: 191969.7389, y: 543767.1543, sta: 25345.090 },Â  // 25km345.090 
 Â  Â  Â  Â  Â  Â  { x: 191970.5232, y: 543731.0956, sta: 25309.000 },Â  // 25km309 
 Â  Â  Â  Â  Â  Â  { x: 191964.6604, y: 543682.5013, sta: 25260.000 },Â  // 25km260 
 Â  Â  Â  Â  Â  Â  { x: 191959.9417, y: 543662.8322, sta: 25240.000 },Â  // 25km240 
 Â  Â  Â  Â  Â  Â  { x: 191949.0639, y: 543630.6385, sta: 25205.769 },Â  // 25km205.769 
 Â  Â  Â  Â  Â  Â  { x: 191929.2976, y: 543589.3926, sta: 25160.000 },Â  // 25km160 
 Â  Â  Â  Â  Â  Â  { x: 191886.7836, y: 543521.6553, sta: 25080.000 },Â  // 25km080 
 Â  Â  Â  Â  Â  Â  { x: 191842.3080, y: 543455.1577, sta: 25000.000 }Â  Â // 25km000 
 Â  Â  Â  Â  ]; 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // ê¸°ë³¸ ë°ì´í„° ìë™ ë¡œë“œ (balpa.pyì—ì„œ ì „ë‹¬ë°›ì€ ë°ì´í„° ì‚¬ìš©) 
 Â  Â  Â  Â  console.log('ê¸°ë³¸ ë°ì´í„° ìë™ ë¡œë“œ ì‹œì‘...'); 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // ì¢Œí‘œê³„ ë³€í™˜ì„ ìœ„í•œ í•¨ìˆ˜ 
 Â  Â  Â  Â  function transformCoordinates(feature) { 
 Â  Â  Â  Â  Â  Â  if (feature.geometry && feature.geometry.coordinates) { 
 Â  Â  Â  Â  Â  Â  Â  Â  if (feature.geometry.type === 'LineString') { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  feature.geometry.coordinates = feature.geometry.coordinates.map(coord => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // EPSG:5186 â†’ WGS84 ë³€í™˜ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const [lng, lat] = proj4('EPSG:5186', 'EPSG:4326', coord); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return [lng, lat]; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }); 
 Â  Â  Â  Â  Â  Â  Â  Â  } else if (feature.geometry.type === 'Point') { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const coord = feature.geometry.coordinates; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const [lng, lat] = proj4('EPSG:5186', 'EPSG:4326', coord); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return feature.geometry.coordinates = [lng, lat]; 
 Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  return feature; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // ì²« ë²ˆì§¸ ë…¸ì„  ë°ì´í„° ë Œë”ë§ 
 Â  Â  Â  Â  if (window.defaultRouteData) { 
 Â  Â  Â  Â  Â  Â  console.log('ê¸°ë³¸ ë…¸ì„  ë°ì´í„°ë¥¼ balpa.pyì—ì„œ ë°›ì•˜ìŠµë‹ˆë‹¤:', window.defaultRouteData); 
 Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  // ëª¨ë“  í”¼ì²˜ì— ëŒ€í•´ ì¢Œí‘œê³„ ë³€í™˜ ì ìš© 
 Â  Â  Â  Â  Â  Â  const transformedData = { 
 Â  Â  Â  Â  Â  Â  Â  Â  ...window.defaultRouteData, 
 Â  Â  Â  Â  Â  Â  Â  Â  features: window.defaultRouteData.features.map(transformCoordinates) 
 Â  Â  Â  Â  Â  Â  }; 
 Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  routeData = transformedData; 
 Â  Â  Â  Â  Â  Â  console.log('ê¸°ë³¸ ë…¸ì„  ë°ì´í„° ë¡œë“œë¨ (ì¢Œí‘œê³„ ë³€í™˜ ì™„ë£Œ):', transformedData); 
 Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  // ë³€í™˜ëœ ë°ì´í„°ë¡œ ë…¸ì„  ë ˆì´ì–´ ìƒì„± 
 Â  Â  Â  Â  Â  Â  routeLayer = L.geoJSON(transformedData, { 
 Â  Â  Â  Â  Â  Â  Â  Â  style: { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  color: '#ff6b35', 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  weight: 3, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  opacity: 0.8 
 Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  }).addTo(map); 
 Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  // ë…¸ì„ ì— ë§ì¶° ì§€ë„ ë·° ì¡°ì • 
 Â  Â  Â  Â  Â  Â  if (transformedData.features && transformedData.features.length > 0) { 
 Â  Â  Â  Â  Â  Â  Â  Â  map.fitBounds(routeLayer.getBounds(), { padding: [50, 50] }); 
 Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  } else { 
 Â  Â  Â  Â  Â  Â  console.log('ê¸°ë³¸ ë…¸ì„  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. íŒŒì¼ ì—…ë¡œë“œê°€ í•„ìš”í•©ë‹ˆë‹¤.'); 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // ê¸°ë³¸ DXF íŒŒì¼ ìë™ ë¡œë“œ (balpa.pyì—ì„œ ì „ë‹¬ë°›ì€ ë°ì´í„° ì‚¬ìš©) 
 Â  Â  Â  Â  console.log('DXF ë°ì´í„° í™•ì¸:', { 
 Â  Â  Â  Â  Â  Â  hasDefaultDxfContent: !!window.defaultDxfContent, 
 Â  Â  Â  Â  Â  Â  defaultDxfContentLength: window.defaultDxfContent ? window.defaultDxfContent.length : 0, 
 Â  Â  Â  Â  Â  Â  defaultDxfContentPreview: window.defaultDxfContent ? window.defaultDxfContent.substring(0, 200) : 'ì—†ìŒ' 
 Â  Â  Â  Â  }); 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  if (window.defaultDxfContent) { 
 Â  Â  Â  Â  Â  Â  console.log('ê¸°ë³¸ DXF íŒŒì¼ì„ balpa.pyì—ì„œ ë°›ì•˜ìŠµë‹ˆë‹¤. íŒŒì‹± ì‹œì‘...'); 
 Â  Â  Â  Â  Â  Â  console.log('DXF ë‚´ìš© ê¸¸ì´:', window.defaultDxfContent.length); 
 Â  Â  Â  Â  Â  Â  console.log('DXF ë‚´ìš© ì‹œì‘ ë¶€ë¶„:', window.defaultDxfContent.substring(0, 100)); 
 Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  // DXF íŒŒì‹± ë° ë Œë”ë§ 
 Â  Â  Â  Â  Â  Â  try { 
 Â  Â  Â  Â  Â  Â  Â  Â  console.log('DXF íŒŒì„œ í™•ì¸:', { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hasDXF: typeof DXF !== 'undefined', 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hasHelper: typeof DXF !== 'undefined' && DXF.Helper, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  DXF: typeof DXF !== 'undefined' ? DXF : 'undefined' 
 Â  Â  Â  Â  Â  Â  Â  Â  }); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // ìƒˆë¡œìš´ DXF íŒŒì„œ ì‹œë„ 
 Â  Â  Â  Â  Â  Â  Â  Â  let CadData; 
 Â  Â  Â  Â  Â  Â  Â  Â  if (typeof DXF !== 'undefined' && DXF.Helper) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('ìƒˆë¡œìš´ DXF íŒŒì„œë¡œ ì‹œë„ ì¤‘...'); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const helper = new DXF.Helper(window.defaultDxfContent); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  CadData = helper.getCadData(); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('ìƒˆë¡œìš´ DXF íŒŒì„œë¡œ ì„±ê³µ:', CadData); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('CadData êµ¬ì¡°:', { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hasEntities: !!CadData.entities, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  entitiesCount: CadData.entities ? CadData.entities.length : 0, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  entitiesPreview: CadData.entities ? CadData.entities.slice(0, 3) : 'ì—†ìŒ' 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } catch (newParserError) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('ìƒˆë¡œìš´ íŒŒì„œ ì‹¤íŒ¨, ê¸°ì¡´ íŒŒì„œ ì‹œë„:', newParserError); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw newParserError; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â  } else { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error('DXF.Helperë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤'); 
 Â  Â  Â  Â  Â  Â  Â  Â  } 

 Â  Â  Â  Â  Â  Â  Â  Â  if (CadData && CadData.entities && CadData.entities.length > 0) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ì¢Œí‘œê³„ ìë™ ê°ì§€ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const firstPoint = findFirstPoint(CadData.entities); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const detectedEPSG = detectCoordinateSystem(firstPoint); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('ê¸°ë³¸ DXF íŒŒì¼ - ì¢Œí‘œê³„ ê°ì§€: EPSG:' + detectedEPSG); 

 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ê° ë„í˜•ì„ ì§€ë„ì— ê·¸ë¦¬ê¸° 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const allLatLngs = []; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('ê¸°ë³¸ DXF íŒŒì¼ - ì´ ì—”í‹°í‹° ìˆ˜:', CadData.entities.length); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  for (const entity of CadData.entities) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const geometry = entityToLatLngs(entity, detectedEPSG); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (geometry.latlngs.length > 0) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const layerName = entity.layer || '0'; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const style = getStyleForEntity(entity, CadData.tables ? CadData.tables.layers : null); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const layerGroup = getOrCreateLayerGroup(layerName, style.color); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(geometry.type === 'polyline') { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  L.polyline(geometry.latlngs, style).addTo(layerGroup); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if(geometry.type === 'circle') { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  L.circle(geometry.latlngs[0], { ...style, radius: geometry.radius }).addTo(layerGroup); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if(geometry.type === 'hatch') { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  L.polygon(geometry.latlngs, { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fillColor: '#FFFF00', 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  color: '#FFD700', 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  weight: 2, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  opacity: 0.3, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fillOpacity: 0.1 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }).addTo(layerGroup); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if(geometry.type === 'text') { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const textContent = entity.text || entity.textString || 'TEXT'; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const textDiv = L.divIcon({ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className: 'text-marker', 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  html: '<div style="color: black; padding: 2px 6px; font-size: 12px; white-space: nowrap; box-shadow: 0 2px 4px rgba(0,0,0,0.3); font-weight: bold;">' + textContent + '</div>', 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  iconSize: [0, 0], 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  iconAnchor: [0, 0] 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const textMarker = L.marker(geometry.latlngs[0], { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  icon: textDiv, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  interactive: true 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }).addTo(layerGroup); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  textMarker.bindPopup( 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  '<div style="min-width: 150px;">' + 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  '<strong>í…ìŠ¤íŠ¸:</strong> ' + textContent + '<br>' + 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  '<strong>ë ˆì´ì–´:</strong> ' + layerName + '<br>' + 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  '<strong>ì¢Œí‘œ:</strong> ' + geometry.latlngs[0][0].toFixed(6) + ', ' + geometry.latlngs[0][1].toFixed(6) + 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  '</div>' 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if(geometry.type === 'point') { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  L.circleMarker(geometry.latlngs[0], { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  radius: 3, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fillColor: '#ff0000', 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  color: '#000', 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  weight: 1, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  opacity: 1, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fillOpacity: 0.8 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }).addTo(layerGroup); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  allLatLngs.push(...geometry.latlngs); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } 

 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (allLatLngs.length > 0) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // DXF ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì§€ë„ ë·° ì¡°ì • 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (routeData && routeData.features && routeData.features.length > 0) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ë…¸ì„ ê³¼ DXF ë°ì´í„°ë¥¼ ëª¨ë‘ í¬í•¨í•˜ëŠ” ë·°ë¡œ ì¡°ì • 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const allBounds = L.latLngBounds(allLatLngs); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const routeBounds = routeLayer.getBounds(); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const combinedBounds = allBounds.extend(routeBounds); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  map.fitBounds(combinedBounds, { padding: [50, 50] }); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  map.fitBounds(L.latLngBounds(allLatLngs), { padding: [50, 50] }); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('ê¸°ë³¸ DXF íŒŒì¼ ë Œë”ë§ ì™„ë£Œ!'); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  } catch (error) { 
 Â  Â  Â  Â  Â  Â  Â  Â  console.log('ê¸°ë³¸ DXF íŒŒì¼ íŒŒì‹± ì‹¤íŒ¨:', error); 
 Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  } else { 
 Â  Â  Â  Â  Â  Â  console.log('ê¸°ë³¸ DXF íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤. íŒŒì¼ ì—…ë¡œë“œê°€ í•„ìš”í•©ë‹ˆë‹¤.'); 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // ë„êµ¬ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ 
 Â  Â  Â  Â  document.getElementById('add-location-btn').addEventListener('click', function() { 
 Â  Â  Â  Â  Â  Â  toggleLocationMode(); 
 Â  Â  Â  Â  }); 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  document.getElementById('measure-distance-btn').addEventListener('click', function() { 
 Â  Â  Â  Â  Â  Â  toggleDistanceMode(); 
 Â  Â  Â  Â  }); 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  document.getElementById('add-blasting-btn').addEventListener('click', function() { 
 Â  Â  Â  Â  Â  Â  toggleBlastingMode(); 
 Â  Â  Â  Â  }); 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  document.getElementById('add-measurement-btn').addEventListener('click', function() { 
 Â  Â  Â  Â  Â  Â  toggleMeasurementMode(); 
 Â  Â  Â  Â  }); 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  document.getElementById('clear-all-btn').addEventListener('click', function() { 
 Â  Â  Â  Â  Â  Â  if (confirm('ëª¨ë“  ìœ„ì¹˜ ë§ˆì»¤ì™€ ê±°ë¦¬ ì¸¡ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) { 
 Â  Â  Â  Â  Â  Â  Â  Â  clearAllMarkers(); 
 Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  }); 
 Â  Â  Â  Â Â  

 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // ëª¨ë‹¬ ê´€ë ¨ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ 
 Â  Â  Â  Â  document.getElementById('close-location-modal').addEventListener('click', function() { 
 Â  Â  Â  Â  Â  Â  closeLocationModal(); 
 Â  Â  Â  Â  }); 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  document.getElementById('cancel-location').addEventListener('click', function() { 
 Â  Â  Â  Â  Â  Â  closeLocationModal(); 
 Â  Â  Â  Â  }); 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // ë°œíŒŒ ëª¨ë‹¬ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ 
 Â  Â  Â  Â  document.getElementById('close-blasting-modal').addEventListener('click', function() { 
 Â  Â  Â  Â  Â  Â  closeBlastingModal(); 
 Â  Â  Â  Â  }); 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  document.getElementById('cancel-blasting').addEventListener('click', function() { 
 Â  Â  Â  Â  Â  Â  closeBlastingModal(); 
 Â  Â  Â  Â  }); 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // ê³„ì¸¡ ëª¨ë‹¬ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ 
 Â  Â  Â  Â  document.getElementById('close-measurement-modal').addEventListener('click', function() { 
 Â  Â  Â  Â  Â  Â  closeMeasurementModal(); 
 Â  Â  Â  Â  }); 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  document.getElementById('cancel-measurement').addEventListener('click', function() { 
 Â  Â  Â  Â  Â  Â  closeMeasurementModal(); 
 Â  Â  Â  Â  }); 
 Â  Â  Â  Â Â  

 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // íƒœê·¸ ì…ë ¥ ì‹œ ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸° 
 Â  Â  Â  Â  document.getElementById('location-tags').addEventListener('input', function() { 
 Â  Â  Â  Â  Â  Â  updateTagsPreview(); 
 Â  Â  Â  Â  }); 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // íƒœê·¸ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸ 
 Â  Â  Â  Â  function updateTagsPreview() { 
 Â  Â  Â  Â  Â  Â  const tagsInput = document.getElementById('location-tags'); 
 Â  Â  Â  Â  Â  Â  const tagsPreview = document.getElementById('tags-preview'); 
 Â  Â  Â  Â  Â  Â  const tags = tagsInput.value.split(',').map(tag => tag.trim()).filter(tag => tag); 
 Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  if (tags.length > 0) { 
 Â  Â  Â  Â  Â  Â  Â  Â  const tagsHTML = tags.map(tag =>Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `<span class="tag-preview" style="display: inline-block; background: #007bff; color: white; padding: 2px 8px; margin: 2px; border-radius: 12px; font-size: 11px;">${tag}</span>` 
 Â  Â  Â  Â  Â  Â  Â  Â  ).join(''); 
 Â  Â  Â  Â  Â  Â  Â  Â  tagsPreview.innerHTML = tagsHTML; 
 Â  Â  Â  Â  Â  Â  } else { 
 Â  Â  Â  Â  Â  Â  Â  Â  tagsPreview.innerHTML = ''; 
 Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // ìœ„ì¹˜ ì¶”ê°€ ëª¨ë“œ í† ê¸€ 
 Â  Â  Â  Â  function toggleLocationMode() { 
 Â  Â  Â  Â  Â  Â  if (isAddingLocation) { 
 Â  Â  Â  Â  Â  Â  Â  Â  isAddingLocation = false; 
 Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('add-location-btn').classList.remove('active'); 
 Â  Â  Â  Â  Â  Â  Â  Â  map.getContainer().style.cursor = ''; 
 Â  Â  Â  Â  Â  Â  } else { 
 Â  Â  Â  Â  Â  Â  Â  Â  // ë‹¤ë¥¸ ëª¨ë“œ ë¹„í™œì„±í™” 
 Â  Â  Â  Â  Â  Â  Â  Â  isMeasuringDistance = false; 
 Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('measure-distance-btn').classList.remove('active'); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // ìœ„ì¹˜ ì¶”ê°€ ëª¨ë“œ í™œì„±í™” 
 Â  Â  Â  Â  Â  Â  Â  Â  isAddingLocation = true; 
 Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('add-location-btn').classList.add('active'); 
 Â  Â  Â  Â  Â  Â  Â  Â  map.getContainer().style.cursor = 'crosshair'; 
 Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // ë°œíŒŒ ëª¨ë“œ í† ê¸€ 
 Â  Â  Â  Â  function toggleBlastingMode() { 
 Â  Â  Â  Â  Â  Â  if (isAddingBlasting) { 
 Â  Â  Â  Â  Â  Â  Â  Â  isAddingBlasting = false; 
 Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('add-blasting-btn').classList.remove('active'); 
 Â  Â  Â  Â  Â  Â  Â  Â  map.getContainer().style.cursor = ''; 
 Â  Â  Â  Â  Â  Â  } else { 
 Â  Â  Â  Â  Â  Â  Â  Â  // ë‹¤ë¥¸ ëª¨ë“œ ë¹„í™œì„±í™” 
 Â  Â  Â  Â  Â  Â  Â  Â  isAddingLocation = false; 
 Â  Â  Â  Â  Â  Â  Â  Â  isMeasuringDistance = false; 
 Â  Â  Â  Â  Â  Â  Â  Â  isAddingMeasurement = false; 
 Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('add-location-btn').classList.remove('active'); 
 Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('measure-distance-btn').classList.remove('active'); 
 Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('add-measurement-btn').classList.remove('active'); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // ë°œíŒŒ ëª¨ë“œ í™œì„±í™” 
 Â  Â  Â  Â  Â  Â  Â  Â  isAddingBlasting = true; 
 Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('add-blasting-btn').classList.add('active'); 
 Â  Â  Â  Â  Â  Â  Â  Â  map.getContainer().style.cursor = 'crosshair'; 
 Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // ê³„ì¸¡ ëª¨ë“œ í† ê¸€ 
 Â  Â  Â  Â  function toggleMeasurementMode() { 
 Â  Â  Â  Â  Â  Â  if (isAddingMeasurement) { 
 Â  Â  Â  Â  Â  Â  Â  Â  isAddingMeasurement = false; 
 Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('add-measurement-btn').classList.remove('active'); 
 Â  Â  Â  Â  Â  Â  Â  Â  map.getContainer().style.cursor = ''; 
 Â  Â  Â  Â  Â  Â  } else { 
 Â  Â  Â  Â  Â  Â  Â  Â  // ë‹¤ë¥¸ ëª¨ë“œ ë¹„í™œì„±í™” 
 Â  Â  Â  Â  Â  Â  Â  Â  isAddingLocation = false; 
 Â  Â  Â  Â  Â  Â  Â  Â  isMeasuringDistance = false; 
 Â  Â  Â  Â  Â  Â  Â  Â  isAddingBlasting = false; 
 Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('add-location-btn').classList.remove('active'); 
 Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('measure-distance-btn').classList.remove('active'); 
 Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('add-blasting-btn').classList.remove('active'); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // ê³„ì¸¡ ëª¨ë“œ í™œì„±í™” 
 Â  Â  Â  Â  Â  Â  Â  Â  isAddingMeasurement = true; 
 Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('add-measurement-btn').classList.add('active'); 
 Â  Â  Â  Â  Â  Â  Â  Â  map.getContainer().style.cursor = 'crosshair'; 
 Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // ê±°ë¦¬ ê³„ì‚° ëª¨ë“œ í† ê¸€ 
 Â  Â  Â  Â  function toggleDistanceMode() { 
 Â  Â  Â  Â  Â  Â  if (isMeasuringDistance) { 
 Â  Â  Â  Â  Â  Â  Â  Â  isMeasuringDistance = false; 
 Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('measure-distance-btn').classList.remove('active'); 
 Â  Â  Â  Â  Â  Â  Â  Â  map.getContainer().style.cursor = ''; 
 Â  Â  Â  Â  Â  Â  Â  Â  finishDistanceMeasurement(); 
 Â  Â  Â  Â  Â  Â  } else { 
 Â  Â  Â  Â  Â  Â  Â  Â  // ë‹¤ë¥¸ ëª¨ë“œ ë¹„í™œì„±í™” 
 Â  Â  Â  Â  Â  Â  Â  Â  isAddingLocation = false; 
 Â  Â  Â  Â  Â  Â  Â  Â  isAddingBlasting = false; 
 Â  Â  Â  Â  Â  Â  Â  Â  isAddingMeasurement = false; 
 Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('add-location-btn').classList.remove('active'); 
 Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('add-blasting-btn').classList.remove('active'); 
 Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('add-measurement-btn').classList.remove('active'); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // ê±°ë¦¬ ê³„ì‚° ëª¨ë“œ í™œì„±í™” 
 Â  Â  Â  Â  Â  Â  Â  Â  isMeasuringDistance = true; 
 Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('measure-distance-btn').classList.add('active'); 
 Â  Â  Â  Â  Â  Â  Â  Â  map.getContainer().style.cursor = 'crosshair'; 
 Â  Â  Â  Â  Â  Â  Â  Â  startDistanceMeasurement(); 
 Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // ê±°ë¦¬ ê³„ì‚° ì‹œì‘ 
 Â  Â  Â  Â  function startDistanceMeasurement() { 
 Â  Â  Â  Â  Â  Â  currentDistancePoints = []; 
 Â  Â  Â  Â  Â  Â  map.on('click', onMapClickForDistance); 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // ê±°ë¦¬ ê³„ì‚°ì„ ìœ„í•œ ì§€ë„ í´ë¦­ ì´ë²¤íŠ¸ 
 Â  Â  Â  Â  function onMapClickForDistance(e) { 
 Â  Â  Â  Â  Â  Â  if (!isMeasuringDistance) return; 
 Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  const latlng = e.latlng; 
 Â  Â  Â  Â  Â  Â  currentDistancePoints.push(latlng); 
 Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  // ë§ˆì»¤ ì¶”ê°€ 
 Â  Â  Â  Â  Â  Â  const marker = L.marker(latlng, { 
 Â  Â  Â  Â  Â  Â  Â  Â  icon: L.divIcon({ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className: 'distance-marker', 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  html: `<div style="background: #007bff; color: white; border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold;">${currentDistancePoints.length}</div>`, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  iconSize: [20, 20] 
 Â  Â  Â  Â  Â  Â  Â  Â  }) 
 Â  Â  Â  Â  Â  Â  }).addTo(map); 
 Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  distanceMarkers.push(marker); 
 Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  // ì„  ê·¸ë¦¬ê¸° 
 Â  Â  Â  Â  Â  Â  if (currentDistancePoints.length > 1) { 
 Â  Â  Â  Â  Â  Â  Â  Â  const polyline = L.polyline([currentDistancePoints[currentDistancePoints.length - 2], latlng], { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  color: '#007bff', 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  weight: 3, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  opacity: 0.8 
 Â  Â  Â  Â  Â  Â  Â  Â  }).addTo(map); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  distancePolylines.push(polyline); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // ê±°ë¦¬ í‘œì‹œ 
 Â  Â  Â  Â  Â  Â  Â  Â  const distance = calculateDistance(currentDistancePoints[currentDistancePoints.length - 2], latlng); 
 Â  Â  Â  Â  Â  Â  Â  Â  L.tooltip({ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  permanent: true, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  direction: 'center' 
 Â  Â  Â  Â  Â  Â  Â  Â  }) 
 Â  Â  Â  Â  Â  Â  Â  Â  .setContent(`${distance.toFixed(2)}m`) 
 Â  Â  Â  Â  Â  Â  Â  Â  .setLatLng([(currentDistancePoints[currentDistancePoints.length - 2].lat + latlng.lat) / 2, (currentDistancePoints[currentDistancePoints.length - 2].lng + latlng.lng) / 2]) 
 Â  Â  Â  Â  Â  Â  Â  Â  .addTo(map); 
 Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // ê±°ë¦¬ ê³„ì‚° ì™„ë£Œ 
 Â  Â  Â  Â  function finishDistanceMeasurement() { 
 Â  Â  Â  Â  Â  Â  map.off('click', onMapClickForDistance); 
 Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  if (currentDistancePoints.length > 1) { 
 Â  Â  Â  Â  Â  Â  Â  Â  const totalDistance = calculateTotalDistance(); 
 Â  Â  Â  Â  Â  Â  Â  Â  alert(`ì´ ê±°ë¦¬: ${totalDistance.toFixed(2)}m`); 
 Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // ë‘ ì  ì‚¬ì´ì˜ ê±°ë¦¬ ê³„ì‚° (ë¯¸í„°) 
 Â  Â  Â  Â  function calculateDistance(point1, point2) { 
 Â  Â  Â  Â  Â  Â  return L.latLng(point1.lat, point1.lng).distanceTo(L.latLng(point2.lat, point2.lng)); 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // ì´ ê±°ë¦¬ ê³„ì‚° 
 Â  Â  Â  Â  function calculateTotalDistance() { 
 Â  Â  Â  Â  Â  Â  let total = 0; 
 Â  Â  Â  Â  Â  Â  for (let i = 1; i < currentDistancePoints.length; i++) { 
 Â  Â  Â  Â  Â  Â  Â  Â  total += calculateDistance(currentDistancePoints[i-1], currentDistancePoints[i]); 
 Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  return total; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // ìœ„ì¹˜ ì¶”ê°€ë¥¼ ìœ„í•œ ì§€ë„ í´ë¦­ ì´ë²¤íŠ¸ 
 Â  Â  Â  Â  map.on('click', function(e) { 
 Â  Â  Â  Â  Â  Â  // ë§ˆì§€ë§‰ í´ë¦­ ìœ„ì¹˜ ì €ì¥ (Station ì‹œì‘ì  ë³€ê²½ ì‹œ STA. ì¬ê³„ì‚°ìš©) 
 Â  Â  Â  Â  Â  Â  window.lastClickedLatLng = e.latlng; 
 Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  if (isAddingLocation) { 
 Â  Â  Â  Â  Â  Â  Â  Â  showLocationModal(e.latlng); 
 Â  Â  Â  Â  Â  Â  } else if (isAddingBlasting) { 
 Â  Â  Â  Â  Â  Â  Â  Â  showBlastingModal(e.latlng); 
 Â  Â  Â  Â  Â  Â  } else if (isAddingMeasurement) { 
 Â  Â  Â  Â  Â  Â  Â  Â  showMeasurementModal(e.latlng); 
 Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  }); 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // ìœ„ì¹˜ ì¶”ê°€ ëª¨ë‹¬ í‘œì‹œ 
 Â  Â  Â  Â  function showLocationModal(latlng) { 
 Â  Â  Â  Â  Â  Â  document.getElementById('location-modal').style.display = 'block'; 
 Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  // í¼ ì œì¶œ ì´ë²¤íŠ¸ 
 Â  Â  Â  Â  Â  Â  document.getElementById('location-form').onsubmit = function(e) { 
 Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault(); 
 Â  Â  Â  Â  Â  Â  Â  Â  addLocationMarker(latlng); 
 Â  Â  Â  Â  Â  Â  Â  Â  closeLocationModal(); 
 Â  Â  Â  Â  Â  Â  }; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // ë°œíŒŒ ëª¨ë‹¬ í‘œì‹œ 
 Â  Â  Â  Â  function showBlastingModal(latlng) { 
 Â  Â  Â  Â  Â  Â  // WGS84 ì¢Œí‘œë¥¼ EPSG:5186ìœ¼ë¡œ ë³€í™˜ 
 Â  Â  Â  Â  Â  Â  const [x, y] = proj4('EPSG:4326', 'EPSG:5186', [latlng.lng, latlng.lat]); 
 Â  Â  Â  Â  Â  Â  const coordinates = `X: ${x.toFixed(3)}, Y: ${y.toFixed(3)}`; 
 Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  // ê¸°ì¤€ì  ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ STA ê°’ ìë™ ê³„ì‚° 
 Â  Â  Â  Â  Â  Â  const sta = calculateSTA(latlng); 
 Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  document.getElementById('blasting-coordinates').value = coordinates; 
 Â  Â  Â  Â  Â  Â  document.getElementById('blasting-sta').value = sta; 
 Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  document.getElementById('blasting-modal').style.display = 'block'; 
 Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  // í¼ ì œì¶œ ì´ë²¤íŠ¸ 
 Â  Â  Â  Â  Â  Â  document.getElementById('blasting-form').onsubmit = function(e) { 
 Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault(); 
 Â  Â  Â  Â  Â  Â  Â  Â  addBlastingMarker(latlng); 
 Â  Â  Â  Â  Â  Â  Â  Â  closeBlastingModal(); 
 Â  Â  Â  Â  Â  Â  }; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // ê³„ì¸¡ ëª¨ë‹¬ í‘œì‹œ 
 Â  Â  Â  Â  function showMeasurementModal(latlng) { 
 Â  Â  Â  Â  Â  Â  // WGS84 ì¢Œí‘œë¥¼ EPSG:5186ìœ¼ë¡œ ë³€í™˜ 
 Â  Â  Â  Â  Â  Â  const [x, y] = proj4('EPSG:4326', 'EPSG:5186', [latlng.lng, latlng.lat]); 
 Â  Â  Â  Â  Â  Â  const coordinates = `X: ${x.toFixed(3)}, Y: ${y.toFixed(3)}`; 
 Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  // ê¸°ì¤€ì  ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ STA ê°’ ìë™ ê³„ì‚° 
 Â  Â  Â  Â  Â  Â  const sta = calculateSTA(latlng); 
 Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  document.getElementById('measurement-coordinates').value = coordinates; 
 Â  Â  Â  Â  Â  Â  document.getElementById('measurement-sta').value = sta; 
 Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  document.getElementById('measurement-modal').style.display = 'block'; 
 Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  // í¼ ì œì¶œ ì´ë²¤íŠ¸ 
 Â  Â  Â  Â  Â  Â  document.getElementById('measurement-form').onsubmit = function(e) { 
 Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault(); 
 Â  Â  Â  Â  Â  Â  Â  Â  addMeasurementMarker(latlng); 
 Â  Â  Â  Â  Â  Â  Â  Â  closeMeasurementModal(); 
 Â  Â  Â  Â  Â  Â  }; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // ìœ„ì¹˜ ì¶”ê°€ ëª¨ë‹¬ ë‹«ê¸° 
 Â  Â  Â  Â  function closeLocationModal() { 
 Â  Â  Â  Â  Â  Â  document.getElementById('location-modal').style.display = 'none'; 
 Â  Â  Â  Â  Â  Â  document.getElementById('location-form').reset(); 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // ë°œíŒŒ ëª¨ë‹¬ ë‹«ê¸° 
 Â  Â  Â  Â  function closeBlastingModal() { 
 Â  Â  Â  Â  Â  Â  document.getElementById('blasting-modal').style.display = 'none'; 
 Â  Â  Â  Â  Â  Â  document.getElementById('blasting-form').reset(); 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // ê³„ì¸¡ ëª¨ë‹¬ ë‹«ê¸° 
 Â  Â  Â  Â  function closeMeasurementModal() { 
 Â  Â  Â  Â  Â  Â  document.getElementById('measurement-modal').style.display = 'none'; 
 Â  Â  Â  Â  Â  Â  document.getElementById('measurement-form').reset(); 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  

 Â  Â  Â  Â Â  

 Â  Â  Â  Â Â  

 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // ìœ„ì¹˜ ë§ˆì»¤ ì¶”ê°€ 
 Â  Â  Â  Â  function addLocationMarker(latlng) { 
 Â  Â  Â  Â  Â  Â  try { 
 Â  Â  Â  Â  Â  Â  Â  Â  // í•„ìˆ˜ í•„ë“œ ê°’ ê°€ì ¸ì˜¤ê¸° 
 Â  Â  Â  Â  Â  Â  Â  Â  const name = document.getElementById('location-name').value.trim(); 
 Â  Â  Â  Â  Â  Â  Â  Â  const description = document.getElementById('location-description').value.trim(); 
 Â  Â  Â  Â  Â  Â  Â  Â  const category = document.getElementById('location-category').value.trim(); 
 Â  Â  Â  Â  Â  Â  Â  Â  const tags = document.getElementById('location-tags').value.split(',').map(tag => tag.trim()).filter(tag => tag); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // í•„ìˆ˜ í•„ë“œ ê²€ì¦ 
 Â  Â  Â  Â  Â  Â  Â  Â  if (!name) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert('âŒ ìœ„ì¹˜ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return; 
 Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // ìœ„ì¹˜ ë§ˆì»¤ ìƒì„± 
 Â  Â  Â  Â  Â  Â  Â  Â  const markerIcon = L.divIcon({ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className: 'location-marker', 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  html: `<div style="background: #28a745; color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: bold;">ğŸ“</div>`, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  iconSize: [24, 24] 
 Â  Â  Â  Â  Â  Â  Â  Â  }); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  const marker = L.marker(latlng, { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  icon: markerIcon 
 Â  Â  Â  Â  Â  Â  Â  Â  }).addTo(map); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // íƒœê·¸ê°€ ìˆëŠ” ê²½ìš° ì§€ë„ì— ì§ì ‘ í…ìŠ¤íŠ¸ ë¼ë²¨ ì¶”ê°€ 
 Â  Â  Â  Â  Â  Â  Â  Â  if (tags.length > 0) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const tagLabel = L.divIcon({ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className: 'tag-label', 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  html: ` 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="background: white; color: #333; padding: 6px 10px; border-radius: 6px; font-size: 13px; font-weight: bold; white-space: nowrap; box-shadow: 0 3px 8px rgba(0,0,0,0.3); border: 2px solid #6f42c1; text-align: center; min-width: 60px;"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${tags[0]} 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  iconSize: [0, 0], 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  iconAnchor: [0, 0] 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const tagMarker = L.marker(latlng, { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  icon: tagLabel, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  interactive: false 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }).addTo(map); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // íƒœê·¸ ë¼ë²¨ì„ ë§ˆì»¤ ì˜¤ë¥¸ìª½ì— ë°°ì¹˜ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tagMarker.setLatLng([ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  latlng.lat, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  latlng.lng + 0.00015 // ë§ˆì»¤ ì˜¤ë¥¸ìª½ì— ì ì ˆí•œ ì˜¤í”„ì…‹ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ]); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // íƒœê·¸ ë§ˆì»¤ë¥¼ ìœ„ì¹˜ ë§ˆì»¤ì™€ í•¨ê»˜ ê´€ë¦¬ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  locationMarkers.push({ marker: marker, tagMarker: tagMarker }); 
 Â  Â  Â  Â  Â  Â  Â  Â  } else { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  locationMarkers.push({ marker: marker, tagMarker: null }); 
 Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // íŒì—… ì •ë³´ ì¶”ê°€ 
 Â  Â  Â  Â  Â  Â  Â  Â  const popupContent = ` 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="min-width: 200px;"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 style="margin: 0 0 10px 0; color: #007bff;">${name}</h4> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${category ? `<p style="margin: 5px 0; color: #666;"><strong>ì¹´í…Œê³ ë¦¬:</strong> ${category}</p>` : ''} 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${description ? `<p style="margin: 5px 0; color: #333;">${description}</p>` : ''} 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${tags.length > 0 ? ` 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="margin: 10px 0;"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p style="margin: 5px 0; color: #666;"><strong>íƒœê·¸:</strong></p> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="display: flex; flex-wrap: wrap; gap: 5px;"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${tags.map(tag => `<span style="background: #ff6b35; color: white; padding: 3px 8px; border-radius: 12px; font-size: 11px;">${tag}</span>`).join('')}</div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ` : ''} 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p style="margin: 5px 0; font-size: 12px; color: #999;"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ì¢Œí‘œ: ${latlng.lat.toFixed(6)}, ${latlng.lng.toFixed(6)} 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </p> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="removeLocationMarker(this)" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; font-size: 12px;">ì‚­ì œ</button> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  `; 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  marker.bindPopup(popupContent); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // ìœ„ì¹˜ ì¶”ê°€ ëª¨ë“œ ë¹„í™œì„±í™” 
 Â  Â  Â  Â  Â  Â  Â  Â  isAddingLocation = false; 
 Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('add-location-btn').classList.remove('active'); 
 Â  Â  Â  Â  Â  Â  Â  Â  map.getContainer().style.cursor = ''; 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // ìœ„ì¹˜ ì •ë³´ ì—…ë°ì´íŠ¸ 
 Â  Â  Â  Â  Â  Â  Â  Â  updateLocationInfo(); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ 
 Â  Â  Â  Â  Â  Â  Â  Â  alert(`ğŸ“ ìœ„ì¹˜ê°€ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nìœ„ì¹˜ëª…: ${name}\nì¢Œí‘œ: ${latlng.lat.toFixed(6)}, ${latlng.lng.toFixed(6)}`); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // ëª¨ë‹¬ ë‹«ê¸° 
 Â  Â  Â  Â  Â  Â  Â  Â  closeLocationModal(); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  } catch (error) { 
 Â  Â  Â  Â  Â  Â  Â  Â  console.error('ìœ„ì¹˜ ë§ˆì»¤ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜:', error); 
 Â  Â  Â  Â  Â  Â  Â  Â  alert('âŒ ìœ„ì¹˜ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message); 
 Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // ë°œíŒŒ ë§ˆì»¤ ì¶”ê°€ 
 Â  Â  Â  Â  async function addBlastingMarker(latlng) { 
 Â  Â  Â  Â  Â  Â  try { 
 Â  Â  Â  Â  Â  Â  Â  Â  // í•„ìˆ˜ í•„ë“œ ê°’ ê°€ì ¸ì˜¤ê¸° 
 Â  Â  Â  Â  Â  Â  Â  Â  const blastingSta = document.getElementById('blasting-sta').value.trim(); 
 Â  Â  Â  Â  Â  Â  Â  Â  const blastingCoordinates = document.getElementById('blasting-coordinates').value.trim(); 
 Â  Â  Â  Â  Â  Â  Â  Â  const blastingDepth = parseFloat(document.getElementById('blasting-depth').value); 
 Â  Â  Â  Â  Â  Â  Â  Â  const blastingDescription = document.getElementById('blasting-description').value.trim(); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // ìë™ìœ¼ë¡œ ë°œíŒŒ ID ìƒì„± (íƒ€ì„ìŠ¤íƒ¬í”„ ê¸°ë°˜) 
 Â  Â  Â  Â  Â  Â  Â  Â  const blastingId = 'BP_' + Date.now(); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  if (!blastingSta) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert('âŒ STA ê°’ì´ ê³„ì‚°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì§€ë„ì—ì„œ ë‹¤ì‹œ í´ë¦­í•´ì£¼ì„¸ìš”.'); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return; 
 Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  if (isNaN(blastingDepth) || blastingDepth <= 0) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert('âŒ ìœ íš¨í•œ ê¹Šì´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return; 
 Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // WGS84 ì¢Œí‘œë¥¼ EPSG:5186ìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ì €ì¥ 
 Â  Â  Â  Â  Â  Â  Â  Â  const [x, y] = proj4('EPSG:4326', 'EPSG:5186', [latlng.lng, latlng.lat]); 
 Â  Â  Â  Â  Â  Â  Â  Â  const epsg5186Coordinates = `X: ${x.toFixed(3)}, Y: ${y.toFixed(3)}`; 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // ë°œíŒŒ ë§ˆì»¤ ìƒì„± (íˆ¬ëª… ë°°ê²½) 
 Â  Â  Â  Â  Â  Â  Â  Â  const markerIcon = L.divIcon({ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className: 'blasting-marker', 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  html: `<div style="background: transparent; color: #dc3545; border: 3px solid #dc3545; border-radius: 50%; width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; font-size: 16px; font-weight: bold;">ğŸ’¥</div>`, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  iconSize: [28, 28] 
 Â  Â  Â  Â  Â  Â  Â  Â  }); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  const marker = L.marker(latlng, { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  icon: markerIcon 
 Â  Â  Â  Â  Â  Â  Â  Â  }).addTo(map); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // ë°œíŒŒ ì •ë³´ë¥¼ ë§ˆì»¤ì— ì €ì¥ 
 Â  Â  Â  Â  Â  Â  Â  Â  marker.blastingData = { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id: blastingId, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sta: blastingSta, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  coordinates: epsg5186Coordinates, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  depth: blastingDepth, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  description: blastingDescription, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  latlng: latlng, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  epsg5186: { x: x, y: y } 
 Â  Â  Â  Â  Â  Â  Â  Â  }; 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // Streamlit ì„¸ì…˜ ìƒíƒœì— ë°œíŒŒìœ„ì¹˜ ì •ë³´ ì €ì¥ 
 Â  Â  Â  Â  Â  Â  Â  Â  const blastingLocationData = { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id: blastingId, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sta: blastingSta, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  coordinates: epsg5186Coordinates, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  depth: blastingDepth, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  description: blastingDescription, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  timestamp: new Date().toISOString() 
 Â  Â  Â  Â  Â  Â  Â  Â  }; 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // ì½˜ì†”ì— ë¡œê·¸ ì¶œë ¥ 
 Â  Â  Â  Â  Â  Â  Â  Â  console.log('ğŸ’¥ ë°œíŒŒìœ„ì¹˜ ì •ë³´:', blastingLocationData); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // íŒì—… ì •ë³´ ì¶”ê°€ 
 Â  Â  Â  Â  Â  Â  Â  Â  const popupContent = ` 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="min-width: 250px;"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 style="margin: 0 0 10px 0; color: #dc3545;">ğŸ’¥ ë°œíŒŒ ìœ„ì¹˜</h4> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p style="margin: 5px 0; color: #333;"><strong>ë°œíŒŒ ID:</strong> ${blastingId}</p> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p style="margin: 5px 0; color: #333;"><strong>STA.:</strong> ${blastingSta}</p> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p style="margin: 5px 0; color: #333;"><strong>ì¢Œí‘œ:</strong> ${epsg5186Coordinates}</p> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p style="margin: 5px 0; color: #333;"><strong>ê¹Šì´:</strong> ${blastingDepth}m</p> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${blastingDescription ? `<p style="margin: 5px 0; color: #333;"><strong>ì„¤ëª…:</strong> ${blastingDescription}</p>` : ''} 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="removeBlastingMarker(this)" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; font-size: 12px;">ì‚­ì œ</button> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  `; 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  marker.bindPopup(popupContent); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // ë°œíŒŒ ë§ˆì»¤ ë°°ì—´ì— ì¶”ê°€ 
 Â  Â  Â  Â  Â  Â  Â  Â  blastingMarkers.push(marker); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // ë°œíŒŒ ì¶”ê°€ ëª¨ë“œ ë¹„í™œì„±í™” 
 Â  Â  Â  Â  Â  Â  Â  Â  isAddingBlasting = false; 
 Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('add-blasting-btn').classList.remove('active'); 
 Â  Â  Â  Â  Â  Â  Â  Â  map.getContainer().style.cursor = ''; 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // ë°œíŒŒ ì •ë³´ ì—…ë°ì´íŠ¸ 
 Â  Â  Â  Â  Â  Â  Â  Â  updateBlastingInfo(); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ 
 Â  Â  Â  Â  Â  Â  Â  Â  alert(`ğŸ’¥ ë°œíŒŒìœ„ì¹˜ê°€ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nID: ${blastingId}\nSTA.: ${blastingSta}\nì¢Œí‘œ: ${epsg5186Coordinates}\nê¹Šì´: ${blastingDepth}m`); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // Supabaseì— ë°œíŒŒìœ„ì¹˜ ë°ì´í„° ì €ì¥ 
 Â  Â  Â  Â  Â  Â  Â  Â  try { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!window.supabaseClient) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error('Supabase í´ë¼ì´ì–¸íŠ¸ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.'); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('ğŸ”„ Supabaseì— ë°œíŒŒìœ„ì¹˜ ì €ì¥ ì‹œë„:', { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  location_id: blastingId, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sta: blastingSta, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  coordinates_x: x, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  coordinates_y: y, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  depth: blastingDepth, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  description: blastingDescription 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { data, error } = await window.supabaseClient 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .from('blasting_locations') 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .insert([ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  location_id: blastingId, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sta: blastingSta, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  coordinates_x: x, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  coordinates_y: y, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  depth: blastingDepth, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  description: blastingDescription 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ]) 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .select(); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (error) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('âŒ Supabase ì €ì¥ ì˜¤ë¥˜:', error); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert('âŒ ë°ì´í„°ë² ì´ìŠ¤ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('âœ… Supabase ì €ì¥ ì„±ê³µ:', data); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert('âœ… ë°œíŒŒìœ„ì¹˜ê°€ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!'); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ì¦‰ì‹œ Streamlitìœ¼ë¡œ ë°œíŒŒìœ„ì¹˜ ë°ì´í„° ì „ì†¡ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sendBlastingLocationsToStreamlit(); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ì‚¬ìš©ìì—ê²Œ ë™ê¸°í™” ì•ˆë‚´ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert('ğŸ’¡ ë°œíŒŒìœ„ì¹˜ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nStreamlit í™”ë©´ì—ì„œ "ğŸ”„ ì¦‰ì‹œ ë™ê¸°í™”" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ìµœì‹  ë°ì´í„°ë¥¼ í™•ì¸í•˜ì„¸ìš”.'); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }, 1000); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â  } catch (e) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('âŒ Supabase ì €ì¥ ì¤‘ ì˜ˆì™¸ ë°œìƒ:', e); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert('âŒ ë°ì´í„°ë² ì´ìŠ¤ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + e.message); 
 Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // ëª¨ë‹¬ ë‹«ê¸° 
 Â  Â  Â  Â  Â  Â  Â  Â  closeBlastingModal(); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  } catch (error) { 
 Â  Â  Â  Â  Â  Â  Â  Â  console.error('ë°œíŒŒ ë§ˆì»¤ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜:', error); 
 Â  Â  Â  Â  Â  Â  Â  Â  alert('âŒ ë°œíŒŒìœ„ì¹˜ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message); 
 Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // ê³„ì¸¡ ë§ˆì»¤ ì¶”ê°€ 
 Â  Â  Â  Â  function addMeasurementMarker(latlng) { 
 Â  Â  Â  Â  Â  Â  try { 
 Â  Â  Â  Â  Â  Â  Â  Â  // í•„ìˆ˜ í•„ë“œ ê°’ ê°€ì ¸ì˜¤ê¸° 
 Â  Â  Â  Â  Â  Â  Â  Â  const measurementSta = document.getElementById('measurement-sta').value.trim(); 
 Â  Â  Â  Â  Â  Â  Â  Â  const measurementCoordinates = document.getElementById('measurement-coordinates').value.trim(); 
 Â  Â  Â  Â  Â  Â  Â  Â  const measurementDescription = document.getElementById('measurement-description').value.trim(); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // í•„ìˆ˜ í•„ë“œ ê²€ì¦ 
 Â  Â  Â  Â  Â  Â  Â  Â  if (!measurementSta) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert('âŒ STA ê°’ì´ ê³„ì‚°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì§€ë„ì—ì„œ ë‹¤ì‹œ í´ë¦­í•´ì£¼ì„¸ìš”.'); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return; 
 Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // WGS84 ì¢Œí‘œë¥¼ EPSG:5186ìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ì €ì¥ 
 Â  Â  Â  Â  Â  Â  Â  Â  const [x, y] = proj4('EPSG:4326', 'EPSG:5186', [latlng.lng, latlng.lat]); 
 Â  Â  Â  Â  Â  Â  Â  Â  const epsg5186Coordinates = `X: ${x.toFixed(3)}, Y: ${y.toFixed(3)}`; 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // ê³„ì¸¡ ë§ˆì»¤ ìƒì„± (íŒŒë€ìƒ‰) 
 Â  Â  Â  Â  Â  Â  Â  Â  const markerIcon = L.divIcon({ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className: 'measurement-marker', 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  html: `<div style="background: #007bff; color: white; border-radius: 50%; width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; font-size: 16px; font-weight: bold;">ğŸ“Š</div>`, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  iconSize: [28, 28] 
 Â  Â  Â  Â  Â  Â  Â  Â  }); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  const marker = L.marker(latlng, { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  icon: markerIcon 
 Â  Â  Â  Â  Â  Â  Â  Â  }).addTo(map); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // ê³„ì¸¡ ì •ë³´ë¥¼ ë§ˆì»¤ì— ì €ì¥ 
 Â  Â  Â  Â  Â  Â  Â  Â  marker.measurementData = { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sta: measurementSta, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  coordinates: epsg5186Coordinates, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  description: measurementDescription, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  latlng: latlng, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  epsg5186: { x: x, y: y } 
 Â  Â  Â  Â  Â  Â  Â  Â  }; 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // ì½˜ì†”ì— ë¡œê·¸ ì¶œë ¥ 
 Â  Â  Â  Â  Â  Â  Â  Â  console.log('ğŸ“Š ê³„ì¸¡ìœ„ì¹˜ ì •ë³´:', marker.measurementData); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // íŒì—… ì •ë³´ ì¶”ê°€ 
 Â  Â  Â  Â  Â  Â  Â  Â  const popupContent = ` 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="min-width: 250px;"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 style="margin: 0 0 10px 0; color: #007bff;">ğŸ“Š ê³„ì¸¡ ìœ„ì¹˜</h4> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p style="margin: 5px 0; color: #333;"><strong>STA.:</strong> ${measurementSta}</p> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p style="margin: 5px 0; color: #333;"><strong>ì¢Œí‘œ:</strong> ${epsg5186Coordinates}</p> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${measurementDescription ? `<p style="margin: 5px 0; color: #333;"><strong>ì„¤ëª…:</strong> ${measurementDescription}</p>` : ''} 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="removeMeasurementMarker(this)" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; font-size: 12px;">ì‚­ì œ</button> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  `; 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  marker.bindPopup(popupContent); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // ê³„ì¸¡ ë§ˆì»¤ ë°°ì—´ì— ì¶”ê°€ 
 Â  Â  Â  Â  Â  Â  Â  Â  measurementMarkers.push(marker); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // ê³„ì¸¡ ì¶”ê°€ ëª¨ë“œ ë¹„í™œì„±í™” 
 Â  Â  Â  Â  Â  Â  Â  Â  isAddingMeasurement = false; 
 Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('add-measurement-btn').classList.remove('active'); 
 Â  Â  Â  Â  Â  Â  Â  Â  map.getContainer().style.cursor = ''; 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // ë°œíŒŒ ì •ë³´ ì—…ë°ì´íŠ¸ (ê±°ë¦¬ ê³„ì‚° í¬í•¨) 
 Â  Â  Â  Â  Â  Â  Â  Â  updateBlastingInfo(); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ 
 Â  Â  Â  Â  Â  Â  Â  Â  alert(`ğŸ“Š ê³„ì¸¡ìœ„ì¹˜ê°€ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nSTA.: ${measurementSta}\nì¢Œí‘œ: ${epsg5186Coordinates}`); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // ëª¨ë‹¬ ë‹«ê¸° 
 Â  Â  Â  Â  Â  Â  Â  Â  closeMeasurementModal(); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  } catch (error) { 
 Â  Â  Â  Â  Â  Â  Â  Â  console.error('ê³„ì¸¡ ë§ˆì»¤ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜:', error); 
 Â  Â  Â  Â  Â  Â  Â  Â  alert('âŒ ê³„ì¸¡ìœ„ì¹˜ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message); 
 Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // ìœ„ì¹˜ ë§ˆì»¤ ì‚­ì œ (ì „ì—­ í•¨ìˆ˜ë¡œ ë“±ë¡) 
 Â  Â  Â  Â  window.removeLocationMarker = function(button) { 
 Â  Â  Â  Â  Â  Â  const marker = button.closest('.leaflet-popup-content').__marker; 
 Â  Â  Â  Â  Â  Â  if (marker) { 
 Â  Â  Â  Â  Â  Â  Â  Â  // ìœ„ì¹˜ ë§ˆì»¤ì™€ íƒœê·¸ ë§ˆì»¤ ëª¨ë‘ ì°¾ì•„ì„œ ì‚­ì œ 
 Â  Â  Â  Â  Â  Â  Â  Â  const locationData = locationMarkers.find(item => item.marker === marker); 
 Â  Â  Â  Â  Â  Â  Â  Â  if (locationData) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  map.removeLayer(locationData.marker); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (locationData.tagMarker) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  map.removeLayer(locationData.tagMarker); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const index = locationMarkers.indexOf(locationData); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (index > -1) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  locationMarkers.splice(index, 1); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ìœ„ì¹˜ ì •ë³´ ì—…ë°ì´íŠ¸ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateLocationInfo(); 
 Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  }; 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // ë°œíŒŒ ë§ˆì»¤ ì‚­ì œ (ì „ì—­ í•¨ìˆ˜ë¡œ ë“±ë¡) 
 Â  Â  Â  Â  window.removeBlastingMarker = function(button) { 
 Â  Â  Â  Â  Â  Â  const marker = button.closest('.leaflet-popup-content').__marker; 
 Â  Â  Â  Â  Â  Â  if (marker) { 
 Â  Â  Â  Â  Â  Â  Â  Â  map.removeLayer(marker); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  const index = blastingMarkers.indexOf(marker); 
 Â  Â  Â  Â  Â  Â  Â  Â  if (index > -1) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  blastingMarkers.splice(index, 1); 
 Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // ë°œíŒŒ ì •ë³´ ì—…ë°ì´íŠ¸ 
 Â  Â  Â  Â  Â  Â  Â  Â  updateBlastingInfo(); 
 Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  }; 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // ê³„ì¸¡ ë§ˆì»¤ ì‚­ì œ (ì „ì—­ í•¨ìˆ˜ë¡œ ë“±ë¡) 
 Â  Â  Â  Â  window.removeMeasurementMarker = function(button) { 
 Â  Â  Â  Â  Â  Â  const marker = button.closest('.leaflet-popup-content').__marker; 
 Â  Â  Â  Â  Â  Â  if (marker) { 
 Â  Â  Â  Â  Â  Â  Â  Â  map.removeLayer(marker); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  const index = measurementMarkers.indexOf(marker); 
 Â  Â  Â  Â  Â  Â  Â  Â  if (index > -1) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  measurementMarkers.splice(index, 1); 
 Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // ë°œíŒŒ ì •ë³´ ì—…ë°ì´íŠ¸ 
 Â  Â  Â  Â  Â  Â  Â  Â  updateBlastingInfo(); 
 Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  }; 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // ì „ì²´ ë§ˆì»¤ ì‚­ì œ 
 Â  Â  Â  Â  function clearAllMarkers() { 
 Â  Â  Â  Â  Â  Â  // ìœ„ì¹˜ ë§ˆì»¤ ì‚­ì œ 
 Â  Â  Â  Â  Â  Â  locationMarkers.forEach(item => { 
 Â  Â  Â  Â  Â  Â  Â  Â  map.removeLayer(item.marker); 
 Â  Â  Â  Â  Â  Â  Â  Â  if (item.tagMarker) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  map.removeLayer(item.tagMarker); 
 Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  }); 
 Â  Â  Â  Â  Â  Â  locationMarkers = []; 
 Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  // ë°œíŒŒ ë§ˆì»¤ ì‚­ì œ 
 Â  Â  Â  Â  Â  Â  blastingMarkers.forEach(marker => map.removeLayer(marker)); 
 Â  Â  Â  Â  Â  Â  blastingMarkers = []; 
 Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  // ê³„ì¸¡ ë§ˆì»¤ ì‚­ì œ 
 Â  Â  Â  Â  Â  Â  measurementMarkers.forEach(marker => map.removeLayer(marker)); 
 Â  Â  Â  Â  Â  Â  measurementMarkers = []; 
 Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  // ê±°ë¦¬ ì¸¡ì • ë§ˆì»¤ ì‚­ì œ 
 Â  Â  Â  Â  Â  Â  distanceMarkers.forEach(marker => map.removeLayer(marker)); 
 Â  Â  Â  Â  Â  Â  distancePolylines.forEach(polyline => map.removeLayer(polyline)); 
 Â  Â  Â  Â  Â  Â  distanceMarkers = []; 
 Â  Â  Â  Â  Â  Â  distancePolylines = []; 
 Â  Â  Â  Â  Â  Â  currentDistancePoints = []; 
 Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  // ì •ë³´ ì—…ë°ì´íŠ¸ 
 Â  Â  Â  Â  Â  Â  updateLocationInfo(); 
 Â  Â  Â  Â  Â  Â  updateBlastingInfo(); 
 Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  // ëª¨ë“œ ë¹„í™œì„±í™” 
 Â  Â  Â  Â  Â  Â  isAddingLocation = false; 
 Â  Â  Â  Â  Â  Â  isMeasuringDistance = false; 
 Â  Â  Â  Â  Â  Â  isAddingBlasting = false; 
 Â  Â  Â  Â  Â  Â  isAddingMeasurement = false; 
 Â  Â  Â  Â  Â  Â  document.getElementById('add-location-btn').classList.remove('active'); 
 Â  Â  Â  Â  Â  Â  document.getElementById('measure-distance-btn').classList.remove('active'); 
 Â  Â  Â  Â  Â  Â  document.getElementById('add-blasting-btn').classList.remove('active'); 
 Â  Â  Â  Â  Â  Â  document.getElementById('add-measurement-btn').classList.remove('active'); 
 Â  Â  Â  Â  Â  Â  map.getContainer().style.cursor = ''; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // ìœ„ì¹˜ ì •ë³´ ì—…ë°ì´íŠ¸ (updateBlastingInfoë¡œ í†µí•©ë¨) 
 Â  Â  Â  Â  function updateLocationInfo() { 
 Â  Â  Â  Â  Â  Â  // updateBlastingInfo í•¨ìˆ˜ê°€ ëª¨ë“  ì •ë³´ë¥¼ í†µí•©í•˜ì—¬ í‘œì‹œí•˜ë¯€ë¡œ ì´ í•¨ìˆ˜ëŠ” ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ 
 Â  Â  Â  Â  Â  Â  updateBlastingInfo(); 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // ë°œíŒŒ ì •ë³´ ì—…ë°ì´íŠ¸ 
 Â  Â  Â  Â  function updateBlastingInfo() { 
 Â  Â  Â  Â  Â  Â  try { 
 Â  Â  Â  Â  Â  Â  Â  Â  // blasting-info ìš”ì†Œê°€ ì—†ìœ¼ë©´ location-infoì— í†µí•©í•˜ì—¬ í‘œì‹œ 
 Â  Â  Â  Â  Â  Â  Â  Â  const locationInfo = document.getElementById('location-info'); 
 Â  Â  Â  Â  Â  Â  Â  Â  if (!locationInfo) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.warn('location-info ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return; 
 Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  let infoHTML = ''; 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // ìœ„ì¹˜ ë§ˆì»¤ ì •ë³´ 
 Â  Â  Â  Â  Â  Â  Â  Â  if (locationMarkers.length > 0) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  infoHTML += '<h5 style="margin: 10px 0 5px 0; color: #28a745;">ğŸ“ ìœ„ì¹˜ ì •ë³´</h5>'; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  locationMarkers.forEach((item, index) => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const latlng = item.marker.getLatLng(); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  infoHTML += ` 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="padding: 8px; margin: 5px 0; background: #f8f9fa; border-radius: 4px; border-left: 3px solid #28a745;"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-weight: bold; color: #333;">ìœ„ì¹˜ ${index + 1}</div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size: 11px; color: #666;">ì¢Œí‘œ: ${latlng.lat.toFixed(6)}, ${latlng.lng.toFixed(6)}</div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }); 
 Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // ë°œíŒŒ ë§ˆì»¤ ì •ë³´ 
 Â  Â  Â  Â  Â  Â  Â  Â  if (blastingMarkers.length > 0) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  infoHTML += '<h5 style="margin: 15px 0 5px 0; color: #dc3545;">ğŸ’¥ ë°œíŒŒ ìœ„ì¹˜</h5>'; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  blastingMarkers.forEach((marker, index) => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const data = marker.blastingData; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  infoHTML += ` 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="padding: 8px; margin: 5px 0; background: #fff5f5; border-radius: 4px; border-left: 3px solid #dc3545;"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-weight: bold; color: #333;">ë°œíŒŒ ${index + 1}</div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size: 11px; color: #666;">ID: ${data.id}</div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size: 11px; color: #666;">STA.: ${data.sta}</div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size: 11px; color: #666;">ê¹Šì´: ${data.depth}m</div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }); 
 Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // ê³„ì¸¡ ë§ˆì»¤ ì •ë³´ 
 Â  Â  Â  Â  Â  Â  Â  Â  if (measurementMarkers.length > 0) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  infoHTML += '<h5 style="margin: 15px 0 5px 0; color: #007bff;">ğŸ“Š ê³„ì¸¡ ìœ„ì¹˜</h5>'; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  measurementMarkers.forEach((marker, index) => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const data = marker.measurementData; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  infoHTML += ` 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="padding: 8px; margin: 5px 0; background: #f0f8ff; border-radius: 4px; border-left: 3px solid #007bff;"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-weight: bold; color: #333;">ê³„ì¸¡ ${index + 1}</div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size: 11px; color: #666;">STA.: ${data.sta}</div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }); 
 Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // ê±°ë¦¬ ê³„ì‚° ê²°ê³¼ 
 Â  Â  Â  Â  Â  Â  Â  Â  if (blastingMarkers.length > 0 && measurementMarkers.length > 0) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  infoHTML += '<h5 style="margin: 15px 0 5px 0; color: #28a745;">ğŸ“ ê±°ë¦¬ ê³„ì‚° ê²°ê³¼</h5>'; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  blastingMarkers.forEach((blastingMarker, bIndex) => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const blastingData = blastingMarker.blastingData; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  measurementMarkers.forEach((measurementMarker, mIndex) => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const measurementData = measurementMarker.measurementData; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Turf.jsë¥¼ ì‚¬ìš©í•œ ìˆ˜í‰ ê±°ë¦¬ ê³„ì‚° 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const horizontalDistance = turf.distance( 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  turf.point([blastingData.latlng.lng, blastingData.latlng.lat]), 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  turf.point([measurementData.latlng.lng, measurementData.latlng.lat]), 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { units: 'meters' } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ì‹¤ì´ê²©ê±°ë¦¬ ê³„ì‚° (í”¼íƒ€ê³ ë¼ìŠ¤ ì •ë¦¬) 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const verticalDistance = blastingData.depth; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const threeDDistance = Math.sqrt(horizontalDistance * horizontalDistance + verticalDistance * verticalDistance); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  infoHTML += ` 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="padding: 8px; margin: 5px 0; background: #f8fff8; border-radius: 4px; border-left: 3px solid #28a745;"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-weight: bold; color: #333;">ë°œíŒŒ ${bIndex + 1} â†” ê³„ì¸¡ ${mIndex + 1}</div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size: 11px; color: #666;">ìˆ˜í‰ ê±°ë¦¬: ${horizontalDistance.toFixed(2)}m</div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size: 11px; color: #666;">ì‹¤ì´ê²©ê±°ë¦¬: ${threeDDistance.toFixed(2)}m</div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size: 11px; color: #666;">ê¹Šì´: ${verticalDistance}m</div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }); 
 Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // ë§ˆì»¤ê°€ í•˜ë‚˜ë„ ì—†ëŠ” ê²½ìš° 
 Â  Â  Â  Â  Â  Â  Â  Â  if (locationMarkers.length === 0 && blastingMarkers.length === 0 && measurementMarkers.length === 0) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  infoHTML = '<div style="color: #666; font-size: 11px; text-align: center; padding: 10px;">ì§€ë„ì—ì„œ ìœ„ì¹˜ë¥¼ ì¶”ê°€í•˜ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>'; 
 Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  locationInfo.innerHTML = infoHTML; 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  } catch (error) { 
 Â  Â  Â  Â  Â  Â  Â  Â  console.error('ì •ë³´ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜:', error); 
 Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // íŒì—…ì— ë§ˆì»¤ ì°¸ì¡° ì¶”ê°€ 
 Â  Â  Â  Â  map.on('popupopen', function(e) { 
 Â  Â  Â  Â  Â  Â  if (e.popup && e.popup.getContent) { 
 Â  Â  Â  Â  Â  Â  Â  Â  const content = e.popup.getContent(); 
 Â  Â  Â  Â  Â  Â  Â  Â  if (content && content.includes('removeLocationMarker')) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.popup.getElement().querySelector('.leaflet-popup-content').__marker = e.target; 
 Â  Â  Â  Â  Â  Â  Â  Â  } else if (content && content.includes('removeBlastingMarker')) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.popup.getElement().querySelector('.leaflet-popup-content').__marker = e.target; 
 Â  Â  Â  Â  Â  Â  Â  Â  } else if (content && content.includes('removeMeasurementMarker')) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.popup.getElement().querySelector('.leaflet-popup-content').__marker = e.target; 
 Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  }); 

 Â  Â  Â  Â  // --- 2. DXF ë Œë”ë§ ë¡œì§ (ëŒ€í­ ê°œì„ ) --- 
 Â  Â  Â  Â  // GeoJSON íŒŒì¼ ë¡œë“œ 
 Â  Â  Â  Â  const geojsonInput = document.getElementById('geojson-input'); 
 Â  Â  Â  Â  geojsonInput.addEventListener('change', function(event) { 
 Â  Â  Â  Â  Â  Â  const file = event.target.files[0]; 
 Â  Â  Â  Â  Â  Â  if (!file) return; 

 Â  Â  Â  Â  Â  Â  const reader = new FileReader(); 
 Â  Â  Â  Â  Â  Â  reader.onload = function(e) { 
 Â  Â  Â  Â  Â  Â  Â  Â  try { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const geojsonData = JSON.parse(e.target.result); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  routeData = geojsonData; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ê¸°ì¡´ ë…¸ì„  ë ˆì´ì–´ ì œê±° 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (routeLayer) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  map.removeLayer(routeLayer); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ì¢Œí‘œê³„ ë³€í™˜ì„ ìœ„í•œ í•¨ìˆ˜ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  function transformCoordinates(feature) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (feature.geometry && feature.geometry.coordinates) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (feature.geometry.type === 'LineString') { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  feature.geometry.coordinates = feature.geometry.coordinates.map(coord => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // EPSG:5186 â†’ WGS84 ë³€í™˜ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const [lng, lat] = proj4('EPSG:5186', 'EPSG:4326', coord); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return [lng, lat]; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (feature.geometry.type === 'Point') { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const coord = feature.geometry.coordinates; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const [lng, lat] = proj4('EPSG:5186', 'EPSG:4326', coord); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  feature.geometry.coordinates = [lng, lat]; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return feature; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ëª¨ë“  í”¼ì²˜ì— ëŒ€í•´ ì¢Œí‘œê³„ ë³€í™˜ ì ìš© 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const transformedData = { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ...geojsonData, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  features: geojsonData.features.map(transformCoordinates) 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ìƒˆë¡œìš´ ë…¸ì„  ë ˆì´ì–´ ì¶”ê°€ (ë³€í™˜ëœ ì¢Œí‘œ ì‚¬ìš©) 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  routeLayer = L.geoJSON(transformedData, { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style: { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  color: '#ff6b35', 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  weight: 3, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  opacity: 0.8 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }).addTo(map); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ë…¸ì„ ì— ë§ì¶° ì§€ë„ ë·° ì¡°ì • 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (geojsonData.features && geojsonData.features.length > 0) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  map.fitBounds(routeLayer.getBounds(), { padding: [50, 50] }); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('geojson-status').textContent = 'ë…¸ì„  ë°ì´í„° ë¡œë“œ ì™„ë£Œ!'; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('GeoJSON ë…¸ì„  ë°ì´í„° ë¡œë“œë¨:', geojsonData); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('GeoJSON íŒŒì¼ íŒŒì‹± ì˜¤ë¥˜:', error); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('geojson-status').textContent = 'ë…¸ì„  íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨.'; 
 Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  }; 
 Â  Â  Â  Â  Â  Â  reader.readAsText(file); 
 Â  Â  Â  Â  }); 

 Â  Â  Â  Â  const dxfInput = document.getElementById('dxf-input'); 
 Â  Â  Â  Â  dxfInput.addEventListener('change', function(event) { 
 Â  Â  Â  Â  Â  Â  const file = event.target.files[0]; 
 Â  Â  Â  Â  Â  Â  if (!file) return; 

 Â  Â  Â  Â  Â  Â  const reader = new FileReader(); 
 Â  Â  Â  Â  Â  Â  reader.onload = async function(e) { 
 Â  Â  Â  Â  Â  Â  Â  Â  const statusEl = document.getElementById('status'); 
 Â  Â  Â  Â  Â  Â  Â  Â  statusEl.textContent = 'íŒŒì¼ ì²˜ë¦¬ ì¤‘...'; 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // ê¸°ì¡´ ë ˆì´ì–´ ì´ˆê¸°í™” 
 Â  Â  Â  Â  Â  Â  Â  Â  dxfLayerGroup.clearLayers(); 
 Â  Â  Â  Â  Â  Â  Â  Â  layerGroups.clear(); 
 Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('layer-control').innerHTML = ''; 

 Â  Â  Â  Â  Â  Â  Â  Â  try { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ë¨¼ì € ìƒˆë¡œìš´ DXF íŒŒì„œ ì‹œë„ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let CadData; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (typeof DXF !== 'undefined' && DXF.Helper) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const helper = new DXF.Helper(e.target.result); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  CadData = helper.getCadData(); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('ìƒˆë¡œìš´ DXF íŒŒì„œë¡œ ì„±ê³µ:', CadData); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } catch (newParserError) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('ìƒˆë¡œìš´ íŒŒì„œ ì‹¤íŒ¨, ê¸°ì¡´ íŒŒì„œ ì‹œë„:', newParserError); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw newParserError; // ê¸°ì¡´ íŒŒì„œë¡œ ë„˜ì–´ê°€ê¸° ìœ„í•´ ì—ëŸ¬ ë°œìƒ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error('DXF.Helperë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤'); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } 

 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!CadData.entities || CadData.entities.length === 0) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusEl.textContent = 'ë„í˜• ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } 

 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // DXF íŒŒì¼ êµ¬ì¡° ìƒì„¸ ë¶„ì„ (ìƒˆë¡œìš´ íŒŒì„œ) 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('ìƒˆë¡œìš´ íŒŒì„œ - DXF í—¤ë” ì •ë³´:', CadData.header); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('ìƒˆë¡œìš´ íŒŒì„œ - DXF í…Œì´ë¸” ì •ë³´:', CadData.tables); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('ìƒˆë¡œìš´ íŒŒì„œ - DXF ë¸”ë¡ ì •ë³´:', CadData.blocks); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ëª¨ë“  ë ˆì´ì–´ ì •ë³´ ìˆ˜ì§‘ (ìƒˆë¡œìš´ íŒŒì„œ) 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const allLayers = new Set(); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  CadData.entities.forEach(entity => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (entity.layer) allLayers.add(entity.layer); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('ìƒˆë¡œìš´ íŒŒì„œ - ë°œê²¬ëœ ëª¨ë“  ë ˆì´ì–´:', Array.from(allLayers)); 

 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ì¢Œí‘œê³„ ìë™ ê°ì§€ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const firstPoint = findFirstPoint(CadData.entities); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const detectedEPSG = detectCoordinateSystem(firstPoint); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusEl.textContent = `ì¢Œí‘œê³„ ê°ì§€: EPSG:${detectedEPSG}. ë„í˜• ë Œë”ë§ ì¤‘...`; 

 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ê° ë„í˜•(entity)ì„ ì§€ë„ì— ê·¸ë¦¬ê¸° 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const allLatLngs = []; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('ì´ ì—”í‹°í‹° ìˆ˜:', CadData.entities.length); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  for (const entity of CadData.entities) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('ì—”í‹°í‹° íƒ€ì…:', entity.type, 'ë ˆì´ì–´:', entity.layer); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const geometry = entityToLatLngs(entity, detectedEPSG); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (geometry.latlngs.length > 0) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const layerName = entity.layer || '0'; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const style = getStyleForEntity(entity, CadData.tables ? CadData.tables.layers : null); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const layerGroup = getOrCreateLayerGroup(layerName, style.color); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(geometry.type === 'polyline') { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  L.polyline(geometry.latlngs, style).addTo(layerGroup); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if(geometry.type === 'circle') { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  L.circle(geometry.latlngs[0], { ...style, radius: geometry.radius }).addTo(layerGroup); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if(geometry.type === 'hatch') { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // HATCH ì—”í‹°í‹°ë¥¼ í´ë¦¬ê³¤ìœ¼ë¡œ ë Œë”ë§ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  L.polygon(geometry.latlngs, { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fillColor: '#FFFF00', 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  color: '#FFD700', 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  weight: 2, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  opacity: 0.3, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fillOpacity: 0.1 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }).addTo(layerGroup); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if(geometry.type === 'text') { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // í…ìŠ¤íŠ¸ ê°ì²´ ë Œë”ë§ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const textContent = entity.text || entity.textString || 'TEXT'; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // í…ìŠ¤íŠ¸ ìœ„ì¹˜ì— ì§ì ‘ HTML ìš”ì†Œ ì¶”ê°€ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const textDiv = L.divIcon({ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className: 'text-marker', 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  html: `<div style="color: black; padding: 2px 6px; font-size: 12px; white-space: nowrap; box-shadow: 0 2px 4px rgba(0,0,0,0.3); font-weight: bold;">${textContent}</div>`, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  iconSize: [0, 0], 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  iconAnchor: [0, 0] 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const textMarker = L.marker(geometry.latlngs[0], { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  icon: textDiv, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  interactive: true 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }).addTo(layerGroup); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // í…ìŠ¤íŠ¸ íŒì—… ì¶”ê°€ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  textMarker.bindPopup(` 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="min-width: 150px;"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <strong>í…ìŠ¤íŠ¸:</strong> ${textContent}<br> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <strong>ë ˆì´ì–´:</strong> ${layerName}<br> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <strong>ì¢Œí‘œ:</strong> ${geometry.latlngs[0][0].toFixed(6)}, ${geometry.latlngs[0][1].toFixed(6)} 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('ìƒˆë¡œìš´ íŒŒì„œ - í…ìŠ¤íŠ¸ ë Œë”ë§ ì„±ê³µ:', textContent, 'ë ˆì´ì–´:', layerName, 'ì¢Œí‘œ:', geometry.latlngs[0]); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if(geometry.type === 'point') { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ì  ê°ì²´ ë Œë”ë§ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  L.circleMarker(geometry.latlngs[0], { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  radius: 3, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fillColor: '#ff0000', 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  color: '#000', 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  weight: 1, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  opacity: 1, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fillOpacity: 0.8 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }).addTo(layerGroup); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  allLatLngs.push(...geometry.latlngs); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('ë³€í™˜ ì‹¤íŒ¨í•œ ì—”í‹°í‹°:', entity.type, entity); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } 

 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (allLatLngs.length > 0) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  map.fitBounds(L.latLngBounds(allLatLngs), { padding: [50, 50] }); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusEl.textContent = `${CadData.entities.length}ê°œ ë„í˜• ë¡œë“œ ì™„ë£Œ!`; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusEl.textContent = 'ìœ íš¨í•œ ë„í˜•ì„ ë³€í™˜í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.'; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } 

 Â  Â  Â  Â  Â  Â  Â  Â  } catch (err) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('ìƒˆë¡œìš´ íŒŒì„œ ì‹¤íŒ¨, ê¸°ì¡´ íŒŒì„œë¡œ ì‹œë„:', err); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ê¸°ì¡´ íŒŒì„œë¡œ ì¬ì‹œë„ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const parser = new DxfParser(); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const dxf = parser.parseSync(e.target.result); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('ê¸°ì¡´ íŒŒì„œë¡œ ì„±ê³µ:', dxf); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // DXF íŒŒì¼ êµ¬ì¡° ìƒì„¸ ë¶„ì„ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('DXF í—¤ë” ì •ë³´:', dxf.header); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('DXF í…Œì´ë¸” ì •ë³´:', dxf.tables); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('DXF ë¸”ë¡ ì •ë³´:', dxf.blocks); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!dxf.entities || dxf.entities.length === 0) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusEl.textContent = 'ë„í˜• ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ëª¨ë“  ë ˆì´ì–´ ì •ë³´ ìˆ˜ì§‘ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const allLayers = new Set(); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dxf.entities.forEach(entity => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (entity.layer) allLayers.add(entity.layer); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('ë°œê²¬ëœ ëª¨ë“  ë ˆì´ì–´:', Array.from(allLayers)); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ì¢Œí‘œê³„ ìë™ ê°ì§€ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const firstPoint = findFirstPointLegacy(dxf.entities); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const detectedEPSG = detectCoordinateSystem(firstPoint); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusEl.textContent = `ì¢Œí‘œê³„ ê°ì§€: EPSG:${detectedEPSG}. ë„í˜• ë Œë”ë§ ì¤‘...`; 

 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ê° ë„í˜•ì„ ì§€ë„ì— ê·¸ë¦¬ê¸° 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const allLatLngs = []; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('ê¸°ì¡´ íŒŒì„œ - ì´ ì—”í‹°í‹° ìˆ˜:', dxf.entities.length); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  for (const entity of dxf.entities) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('ê¸°ì¡´ íŒŒì„œ - ì—”í‹°í‹° íƒ€ì…:', entity.type, 'ë ˆì´ì–´:', entity.layer); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const geometry = entityToLatLngsLegacy(entity, detectedEPSG); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (geometry.latlngs.length > 0) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const layerName = entity.layer || '0'; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const style = getStyleForEntityLegacy(entity); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const layerGroup = getOrCreateLayerGroup(layerName, style.color); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(geometry.type === 'polyline') { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  L.polyline(geometry.latlngs, style).addTo(layerGroup); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if(geometry.type === 'circle') { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  L.circle(geometry.latlngs[0], { ...style, radius: geometry.radius }).addTo(layerGroup); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if(geometry.type === 'hatch') { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // HATCH ì—”í‹°í‹°ë¥¼ í´ë¦¬ê³¤ìœ¼ë¡œ ë Œë”ë§ (ê¸°ì¡´ íŒŒì„œìš©) 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  L.polygon(geometry.latlngs, { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fillColor: '#FFFF00', 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  color: '#FFD700', 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  weight: 2, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  opacity: 0.3, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fillOpacity: 0.1 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }).addTo(layerGroup); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if(geometry.type === 'text') { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // í…ìŠ¤íŠ¸ ê°ì²´ ë Œë”ë§ (ê¸°ì¡´ íŒŒì„œìš©) 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const textContent = entity.text || entity.textString || 'TEXT'; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // í…ìŠ¤íŠ¸ ìœ„ì¹˜ì— ì§ì ‘ HTML ìš”ì†Œ ì¶”ê°€ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const textDiv = L.divIcon({ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className: 'text-marker', 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  html: `<div style="color: black; padding: 2px 6px; font-size: 12px; white-space: nowrap; box-shadow: 0 2px 4px rgba(0,0,0,0.3); font-weight: bold;">${textContent}</div>`, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  iconSize: [0, 0], 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  iconAnchor: [0, 0] 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const textMarker = L.marker(geometry.latlngs[0], { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  icon: textDiv, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  interactive: true 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }).addTo(layerGroup); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // í…ìŠ¤íŠ¸ íŒì—… ì¶”ê°€ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  textMarker.bindPopup(` 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="min-width: 150px;"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <strong>í…ìŠ¤íŠ¸:</strong> ${textContent}<br> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <strong>ë ˆì´ì–´:</strong> ${layerName}<br> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <strong>ì¢Œí‘œ:</strong> ${geometry.latlngs[0][0].toFixed(6)}, ${geometry.latlngs[0][1].toFixed(6)} 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('í…ìŠ¤íŠ¸ ë Œë”ë§ ì„±ê³µ:', textContent, 'ë ˆì´ì–´:', layerName, 'ì¢Œí‘œ:', geometry.latlngs[0]); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if(geometry.type === 'point') { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ì  ê°ì²´ ë Œë”ë§ (ê¸°ì¡´ íŒŒì„œìš©) 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  L.circleMarker(geometry.latlngs[0], { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  radius: 3, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fillColor: '#ff0000', 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  color: '#000', 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  weight: 1, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  opacity: 1, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fillOpacity: 0.8 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }).addTo(layerGroup); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  allLatLngs.push(...geometry.latlngs); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('ê¸°ì¡´ íŒŒì„œ - ë³€í™˜ ì‹¤íŒ¨í•œ ì—”í‹°í‹°:', entity.type, entity); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } 

 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (allLatLngs.length > 0) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  map.fitBounds(L.latLngBounds(allLatLngs), { padding: [50, 50] }); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusEl.textContent = `${dxf.entities.length}ê°œ ë„í˜• ë¡œë“œ ì™„ë£Œ! (ê¸°ì¡´ íŒŒì„œ)`; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusEl.textContent = 'ìœ íš¨í•œ ë„í˜•ì„ ë³€í™˜í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.'; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } catch (legacyError) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('ëª¨ë“  DXF íŒŒì„œ ì‹¤íŒ¨:', legacyError); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusEl.textContent = 'DXF íŒŒì¼ ì²˜ë¦¬ ì‹¤íŒ¨. ì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”.'; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  }; 
 Â  Â  Â  Â  Â  Â  reader.readAsText(file, 'UTF-8'); 
 Â  Â  Â  Â  }); 

 Â  Â  Â  Â  // --- 3. í—¬í¼ í•¨ìˆ˜ë“¤ --- 
 Â  
 Â  Â  Â  Â  Â function findFirstPoint(entities) { 
 Â  Â  Â  Â  Â  Â  Â for(const entity of entities) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â if(entity.vertices && entity.vertices.length > 0) return entity.vertices[0]; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â if(entity.startPoint) return entity.startPoint; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â if(entity.center) return entity.center; 
 Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â return null; 
 Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  
 Â  Â  Â  Â  Â // ê¸°ì¡´ íŒŒì„œìš© í—¬í¼ í•¨ìˆ˜ë“¤ 
 Â  Â  Â  Â  Â function findFirstPointLegacy(entities) { 
 Â  Â  Â  Â  Â  Â  Â for(const entity of entities) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â if(entity.vertices && entity.vertices.length > 0) return entity.vertices[0]; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â if(entity.startPoint) return entity.startPoint; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â if(entity.center) return entity.center; 
 Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â return null; 
 Â  Â  Â  Â  Â } 
 Â  
 Â  Â  Â  Â  Â function detectCoordinateSystem(point) { 
 Â  Â  Â  Â  Â  Â  Â if (!point) return "5186"; // ì ì´ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ ë°˜í™˜ 
 Â  Â  Â  Â  Â  Â  Â  
 Â  Â  Â  Â  Â  Â  Â console.log('ì¢Œí‘œê³„ ê°ì§€ - ì…ë ¥ ì¢Œí‘œ:', point); 
 Â  Â  Â  Â  Â  Â  Â  
 Â  Â  Â  Â  Â  Â  Â // ë” ë§ì€ í•œêµ­ ì¢Œí‘œê³„ ì§€ì› 
 Â  Â  Â  Â  Â  Â  Â const epsgCodes = ["5186", "5179", "5181", "5187", "5188", "5189", "5190", "5191", "5192", "5193", "5194", "5195", "5196", "5197", "5198", "5199"]; 
 Â  Â  Â  Â  Â  Â  Â  
 Â  Â  Â  Â  Â  Â  Â for (const code of epsgCodes) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â try { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const [lon, lat] = proj4(`EPSG:${code}`, "EPSG:4326", [point.x, point.y]); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â console.log(`EPSG:${code} ë³€í™˜ ê²°ê³¼:`, lon, lat); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // í•œêµ­ ì˜ì—­ ë‚´ ì¢Œí‘œì¸ì§€ í™•ì¸ (ë” ë„“ì€ ë²”ìœ„) 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (lat >= 30 && lat <= 45 && lon >= 120 && lon <= 140) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â console.log(`ì¢Œí‘œê³„ ê°ì§€ ì„±ê³µ: EPSG:${code}`); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â return code; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â } catch (e) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â console.log(`EPSG:${code} ë³€í™˜ ì‹¤íŒ¨:`, e.message); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  
 Â  Â  Â  Â  Â  Â  Â console.log('ì¢Œí‘œê³„ ê°ì§€ ì‹¤íŒ¨, ê¸°ë³¸ê°’ EPSG:5186 ì‚¬ìš©'); 
 Â  Â  Â  Â  Â  Â  Â return "5186"; // ê°ì§€ ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ê°’ 
 Â  Â  Â  Â  Â } 
 Â  
 Â  Â  Â  Â  Â function getOrCreateLayerGroup(layerName, color) { 
 Â  Â  Â  Â  Â  Â  Â if (!layerGroups.has(layerName)) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â const group = L.layerGroup(); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â layerGroups.set(layerName, group); 
 Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â // ë ˆì´ì–´ ì»¨íŠ¸ë¡¤ UI ì¶”ê°€ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â const controlEl = document.getElementById('layer-control'); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â const div = document.createElement('div'); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â div.className = 'layer-item'; // ìƒˆë¡œìš´ í´ë˜ìŠ¤ ì¶”ê°€ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â div.innerHTML = ` 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <input type="checkbox" id="layer-${layerName}" checked> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <label for="layer-${layerName}" style="color:${color};">${layerName}</label> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <input type="range" class="layer-opacity" min="0" max="1" step="0.1" value="1" onchange="setLayerOpacity(this.id.replace('layer-', ''), this.value)"> 
 Â  Â  Â  Â  Â  Â  Â  Â  Â `; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â controlEl.appendChild(div); 
 Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â div.querySelector('input[type="checkbox"]').addEventListener('change', function() { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (this.checked) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â group.addTo(dxfLayerGroup); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } else { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â dxfLayerGroup.removeLayer(group); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â }); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â div.querySelector('.layer-opacity').addEventListener('input', function() { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â setLayerOpacity(layerName, this.value); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â }); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â // ì´ˆê¸° ìƒíƒœë¡œ ë ˆì´ì–´ ì¶”ê°€ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â group.addTo(dxfLayerGroup); 
 Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â return layerGroups.get(layerName); 
 Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  
 Â  Â  Â  Â  Â function getStyleForEntity(entity, layerTable) { 
 Â  Â  Â  Â  Â  Â  Â const layerName = entity.layer || '0'; 
 Â  Â  Â  Â  Â  Â  Â const layerInfo = layerTable ? layerTable[layerName] : null; 
 Â  Â  Â  Â  Â  Â  Â let color = '#FFFF00'; // ê¸°ë³¸ìƒ‰: ë…¸ë€ìƒ‰ 
 Â  
 Â  Â  Â  Â  Â  Â  Â if (entity.colorNumber) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  color = DXF.ACAD_COLOR_PALETTE[entity.colorNumber] ? '#' + DXF.ACAD_COLOR_PALETTE[entity.colorNumber].toString(16).padStart(6, '0') : color; 
 Â  Â  Â  Â  Â  Â  Â } else if (layerInfo && layerInfo.colorNumber) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  color = DXF.ACAD_COLOR_PALETTE[layerInfo.colorNumber] ? '#' + DXF.ACAD_COLOR_PALETTE[layerInfo.colorNumber].toString(16).padStart(6, '0') : color; 
 Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  
 Â  Â  Â  Â  Â  Â  Â return { color: color, weight: 1, opacity: 0.95 }; 
 Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  
 Â  Â  Â  Â  Â // ê¸°ì¡´ íŒŒì„œìš© ìŠ¤íƒ€ì¼ í•¨ìˆ˜ 
 Â  Â  Â  Â  Â function getStyleForEntityLegacy(entity) { 
 Â  Â  Â  Â  Â  Â  Â const layerName = entity.layer || '0'; 
 Â  Â  Â  Â  Â  Â  Â let color = '#FFFF00'; // ê¸°ë³¸ìƒ‰: ë…¸ë€ìƒ‰ 
 Â  Â  Â  Â  Â  Â  Â  
 Â  Â  Â  Â  Â  Â  Â // ë ˆì´ì–´ë³„ ìƒ‰ìƒ ë§¤í•‘ 
 Â  Â  Â  Â  Â  Â  Â const layerColors = { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â '0': '#FFFF00', 'WALL': '#FFFF00', 'DOOR': '#00FF00', 'WINDOW': '#0000FF', 
 Â  Â  Â  Â  Â  Â  Â  Â  Â 'DIMENSION': '#FFFF00', 'TEXT': '#FF00FF', 'HATCH': '#00FFFF', 'CENTER': '#FF8000', 
 Â  Â  Â  Â  Â  Â  Â  Â  Â 'HIDDEN': '#808080', 'BORDER': '#FF0000', 'UTILITY': '#008000', 'EQUIPMENT': '#800000', 
 Â  Â  Â  Â  Â  Â  Â  Â  Â 'ANNOTATION': '#000080', 'ROAD': '#FFFF00', 'BUILDING': '#FFFF00', 'STRUCTURE': '#FF0000', 
 Â  Â  Â  Â  Â  Â  Â  Â  Â 'PIPE': '#00FFFF', 'ELECTRICAL': '#FF00FF', 'MECHANICAL': '#FF8000' 
 Â  Â  Â  Â  Â  Â  Â }; 
 Â  Â  Â  Â  Â  Â  Â  
 Â  Â  Â  Â  Â  Â  Â if (layerColors[layerName]) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â color = layerColors[layerName]; 
 Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  
 Â  Â  Â  Â  Â  Â  Â return { color: color, weight: 0.8, opacity: 0.95 }; 
 Â  Â  Â  Â  Â } 
 Â  
 Â  Â  Â  Â  Â function entityToLatLngs(entity, epsg) { 
 Â  Â  Â  Â  Â  Â  Â let latlngs = [], type = 'polyline', radius = 0; 
 Â  Â  Â  Â  Â  Â  Â const transform = (p) => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â if(!p || typeof p.x === 'undefined' || typeof p.y === 'undefined') return null; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â const [lon, lat] = proj4(`EPSG:${epsg}`, "EPSG:4326", [p.x, p.y]); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â return [lat, lon]; 
 Â  Â  Â  Â  Â  Â  Â }; 
 Â  
 Â  Â  Â  Â  Â  Â  Â switch (entity.type) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â case 'LINE': 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â latlngs = [transform(entity.startPoint), transform(entity.endPoint)].filter(p => p); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â break; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â case 'LWPOLYLINE': 
 Â  Â  Â  Â  Â  Â  Â  Â  Â case 'POLYLINE': 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â latlngs = entity.vertices.map(transform).filter(p => p); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â break; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â case 'CIRCLE': 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const centerLatLng = transform(entity.center); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if(centerLatLng) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â latlngs.push(centerLatLng); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // ì›ì˜ ë°˜ì§€ë¦„ì„ ì§€ë„ ë‹¨ìœ„(ë¯¸í„°)ë¡œ ê·¼ì‚¬ ê³„ì‚° 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const edgePoint = { x: entity.center.x + entity.radius, y: entity.center.y }; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const edgeLatLng = transform(edgePoint); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â radius = L.latLng(centerLatLng).distanceTo(L.latLng(edgeLatLng)); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â type = 'circle'; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â break; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â case 'ARC': 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // ARCë¥¼ Polylineìœ¼ë¡œ ê·¼ì‚¬í™” (10ê°œ ì  ì‚¬ìš©) 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const arcPoints = []; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const startAngle = entity.startAngle * Math.PI / 180; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const endAngle = entity.endAngle * Math.PI / 180; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const angleStep = (endAngle - startAngle) / 10; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â for (let i = 0; i <= 10; i++) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const angle = startAngle + i * angleStep; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â arcPoints.push({ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â x: entity.center.x + entity.radius * Math.cos(angle), 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â y: entity.center.y + entity.radius * Math.sin(angle) 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â latlngs = arcPoints.map(transform).filter(p => p); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â break; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â // ìš©ì§€ë„ ê´€ë ¨ ì¶”ê°€ ì—”í‹°í‹°ë“¤ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â case 'TEXT': 
 Â  Â  Â  Â  Â  Â  Â  Â  Â case 'MTEXT': 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (entity.startPoint) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â latlngs = [transform(entity.startPoint)]; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â type = 'text'; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â break; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â case 'DIMENSION': 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (entity.definitionPoint) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â latlngs = [transform(entity.definitionPoint)]; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â type = 'dimension'; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â break; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â case 'HATCH': 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (entity.boundaryPaths && entity.boundaryPaths.length > 0) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // HATCHì˜ ê²½ê³„ì„ ì„ Polylineìœ¼ë¡œ ë³€í™˜ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â for (const path of entity.boundaryPaths) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (path.edges) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â for (const edge of path.edges) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (edge.type === 'LINE') { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â latlngs.push(transform(edge.startPoint), transform(edge.endPoint)); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â break; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â case 'INSERT': 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (entity.insertionPoint) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â latlngs = [transform(entity.insertionPoint)]; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â type = 'insert'; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â break; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â case 'POINT': 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (entity.position) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â latlngs = [transform(entity.position)]; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â type = 'point'; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â break; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â case 'SPLINE': 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (entity.controlPoints && entity.controlPoints.length > 0) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // SPLINEì„ ê·¼ì‚¬í™”í•˜ì—¬ Polylineìœ¼ë¡œ ë³€í™˜ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â latlngs = entity.controlPoints.map(transform).filter(p => p); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â type = 'spline'; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â break; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â case 'ELLIPSE': 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (entity.center) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const centerLatLng = transform(entity.center); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (centerLatLng) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â latlngs.push(centerLatLng); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // íƒ€ì›ì„ ì›ìœ¼ë¡œ ê·¼ì‚¬í™” 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const majorAxis = entity.majorAxis || { x: 1, y: 0 }; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const majorPoint = {Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â x: entity.center.x + majorAxis.x,Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â y: entity.center.y + majorAxis.yÂ  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const majorLatLng = transform(majorPoint); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (majorLatLng) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â radius = L.latLng(centerLatLng).distanceTo(L.latLng(majorLatLng)); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â type = 'ellipse'; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â break; 
 Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â return { latlngs, type, radius }; 
 Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  
 Â  Â  Â  Â  Â // ê¸°ì¡´ íŒŒì„œìš© ì—”í‹°í‹° ë³€í™˜ í•¨ìˆ˜ 
 Â  Â  Â  Â  Â function entityToLatLngsLegacy(entity, epsg) { 
 Â  Â  Â  Â  Â  Â  Â let latlngs = [], type = 'polyline', radius = 0; 
 Â  Â  Â  Â  Â  Â  Â const transform = (p) => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â if(!p || typeof p.x === 'undefined' || typeof p.y === 'undefined') return null; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â const [lon, lat] = proj4(`EPSG:${epsg}`, "EPSG:4326", [p.x, p.y]); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â return [lat, lon]; 
 Â  Â  Â  Â  Â  Â  Â }; 
 Â  
 Â  Â  Â  Â  Â  Â  Â switch (entity.type) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â case 'LINE': 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (entity.vertices && entity.vertices.length >= 2) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â latlngs = [transform(entity.vertices[0]), transform(entity.vertices[1])].filter(p => p); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â break; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â case 'LWPOLYLINE': 
 Â  Â  Â  Â  Â  Â  Â  Â  Â case 'POLYLINE': 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (entity.vertices && entity.vertices.length >= 2) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â latlngs = entity.vertices.map(transform).filter(p => p); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â break; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â case 'CIRCLE': 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (entity.center) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const centerLatLng = transform(entity.center); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if(centerLatLng) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â latlngs.push(centerLatLng); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // ì›ì˜ ë°˜ì§€ë¦„ì„ ì§€ë„ ë‹¨ìœ„(ë¯¸í„°)ë¡œ ê·¼ì‚¬ ê³„ì‚° 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const edgePoint = { x: entity.center.x + entity.radius, y: entity.center.y }; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const edgeLatLng = transform(edgePoint); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (edgeLatLng) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â radius = L.latLng(centerLatLng).distanceTo(L.latLng(edgeLatLng)); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â type = 'circle'; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â break; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â case 'ARC': 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (entity.center && entity.radius && entity.startAngle !== undefined && entity.endAngle !== undefined) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // ARCë¥¼ Polylineìœ¼ë¡œ ê·¼ì‚¬í™” (10ê°œ ì  ì‚¬ìš©) 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const arcPoints = []; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const startAngle = entity.startAngle * Math.PI / 180; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const endAngle = entity.endAngle * Math.PI / 180; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const angleStep = (endAngle - startAngle) / 10; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â for (let i = 0; i <= 10; i++) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const angle = startAngle + i * angleStep; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â arcPoints.push({ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â x: entity.center.x + entity.radius * Math.cos(angle), 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â y: entity.center.y + entity.radius * Math.sin(angle) 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â latlngs = arcPoints.map(transform).filter(p => p); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â break; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â // ìš©ì§€ë„ ê´€ë ¨ ì¶”ê°€ ì—”í‹°í‹°ë“¤ (ê¸°ì¡´ íŒŒì„œìš©) 
 Â  Â  Â  Â  Â  Â  Â  Â  Â case 'TEXT': 
 Â  Â  Â  Â  Â  Â  Â  Â  Â case 'MTEXT': 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (entity.startPoint) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â latlngs = [transform(entity.startPoint)]; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â type = 'text'; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â break; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â case 'DIMENSION': 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (entity.definitionPoint) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â latlngs = [transform(entity.definitionPoint)]; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â type = 'dimension'; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â break; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â case 'HATCH': 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (entity.boundaryPaths && entity.boundaryPaths.length > 0) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // HATCHì˜ ê²½ê³„ì„ ì„ Polylineìœ¼ë¡œ ë³€í™˜í•˜ê³  ë©´ì  ì±„ìš°ê¸° 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â for (const path of entity.boundaryPaths) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (path.edges) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const boundaryPoints = []; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â for (const edge of path.edges) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (edge.type === 'LINE') { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const startPoint = transform(edge.startPoint); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const endPoint = transform(edge.endPoint); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (startPoint && endPoint) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â boundaryPoints.push(startPoint, endPoint); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (boundaryPoints.length >= 3) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // ë©´ì  ì±„ìš°ê¸°ë¥¼ ìœ„í•œ í´ë¦¬ê³¤ ìƒì„± 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â latlngs = boundaryPoints; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â type = 'hatch'; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â break; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â case 'INSERT': 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (entity.insertionPoint) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â latlngs = [transform(entity.insertionPoint)]; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â type = 'insert'; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â break; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â case 'POINT': 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (entity.position) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â latlngs = [transform(entity.position)]; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â type = 'point'; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â break; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â case 'SPLINE': 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (entity.controlPoints && entity.controlPoints.length > 0) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // SPLINEì„ ê·¼ì‚¬í™”í•˜ì—¬ Polylineìœ¼ë¡œ ë³€í™˜ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â latlngs = entity.controlPoints.map(transform).filter(p => p); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â type = 'spline'; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â break; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â case 'ELLIPSE': 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (entity.center) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const centerLatLng = transform(entity.center); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (centerLatLng) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â latlngs.push(centerLatLng); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // íƒ€ì›ì„ ì›ìœ¼ë¡œ ê·¼ì‚¬í™” 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const majorAxis = entity.majorAxis || { x: 1, y: 0 }; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const majorPoint = {Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â x: entity.center.x + majorAxis.x,Â  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â y: entity.center.y + majorAxis.yÂ  
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const majorLatLng = transform(majorPoint); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (majorLatLng) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â radius = L.latLng(centerLatLng).distanceTo(L.latLng(majorPoint)); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â type = 'ellipse'; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â break; 
 Â  Â  Â  Â  Â  Â  Â } 
 Â  Â  Â  Â  Â  Â  Â return { latlngs, type, radius }; 
 Â  Â  Â  Â  Â } 

 Â  Â  Â  Â  Â  Â  Â  Â  Â // STA. ê°’ ê³„ì‚° í•¨ìˆ˜ (ê¸°ì¤€ì  ë°ì´í„° ê¸°ë°˜) 
 Â  Â  Â  Â  function calculateSTA(latlng, stationStart = 0) { 
 Â  Â  Â  Â  Â  Â  // í´ë¦­í•œ ìœ„ì¹˜ë¥¼ EPSG:5186 ì¢Œí‘œë¡œ ë³€í™˜ 
 Â  Â  Â  Â  Â  Â  const [clickX, clickY] = proj4('EPSG:4326', 'EPSG:5186', [latlng.lng, latlng.lat]); 
 Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  let minDistance = Infinity; 
 Â  Â  Â  Â  Â  Â  let closestSTA = 'ê³„ì‚° ë¶ˆê°€'; 
 Â  Â  Â  Â  Â  Â  let closestPoint = null; 
 Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  // ëª¨ë“  ê¸°ì¤€ì ê³¼ì˜ ê±°ë¦¬ ê³„ì‚°í•˜ì—¬ ê°€ì¥ ê°€ê¹Œìš´ ì§€ì  ì°¾ê¸° 
 Â  Â  Â  Â  Â  Â  referencePoints.forEach(point => { 
 Â  Â  Â  Â  Â  Â  Â  Â  const distance = Math.sqrt( 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Math.pow(clickX - point.x, 2) + Math.pow(clickY - point.y, 2) 
 Â  Â  Â  Â  Â  Â  Â  Â  ); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  if (distance < minDistance) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  minDistance = distance; 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  closestPoint = point; 
 Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  }); 
 Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  if (closestPoint) { 
 Â  Â  Â  Â  Â  Â  Â  Â  // ê¸°ì¤€ì ì—ì„œ í´ë¦­í•œ ì§€ì ê¹Œì§€ì˜ ì‹¤ì œ ê±°ë¦¬ ê³„ì‚° (ë¯¸í„° ë‹¨ìœ„) 
 Â  Â  Â  Â  Â  Â  Â  Â  const distanceFromReference = Math.sqrt( 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Math.pow(clickX - closestPoint.x, 2) + Math.pow(clickY - closestPoint.y, 2) 
 Â  Â  Â  Â  Â  Â  Â  Â  ); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // ë…¸ì„  ì§„í–‰ ë°©í–¥ì„ ê³ ë ¤í•œ STA ê°’ ê³„ì‚° 
 Â  Â  Â  Â  Â  Â  Â  Â  // ê¸°ì¤€ì ì˜ STA ê°’ì— ê±°ë¦¬ ì°¨ì´ë¥¼ ë”í•˜ê±°ë‚˜ ë¹¼ê¸° 
 Â  Â  Â  Â  Â  Â  Â  Â  let estimatedSTA = closestPoint.sta; 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // í´ë¦­í•œ ì§€ì ì´ ê¸°ì¤€ì ë³´ë‹¤ ë…¸ì„  ì§„í–‰ ë°©í–¥ì— ìˆëŠ”ì§€ íŒë‹¨ 
 Â  Â  Â  Â  Â  Â  Â  Â  // ê°„ë‹¨í•œ ë°©ë²•: Y ì¢Œí‘œê°€ ì‘ì„ìˆ˜ë¡ ë…¸ì„  ì§„í–‰ ë°©í–¥ (25km â†’ 27km) 
 Â  Â  Â  Â  Â  Â  Â  Â  const isForward = clickY < closestPoint.y; 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  if (isForward) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ë…¸ì„  ì§„í–‰ ë°©í–¥: STA ê°’ ì¦ê°€ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  estimatedSTA = closestPoint.sta + distanceFromReference; 
 Â  Â  Â  Â  Â  Â  Â  Â  } else { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ë…¸ì„  ë°˜ëŒ€ ë°©í–¥: STA ê°’ ê°ì†Œ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  estimatedSTA = closestPoint.sta - distanceFromReference; 
 Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // STA. í˜•ì‹ìœ¼ë¡œ ë³€í™˜ (km+m í˜•ì‹) 
 Â  Â  Â  Â  Â  Â  Â  Â  const km = Math.floor(estimatedSTA / 1000); 
 Â  Â  Â  Â  Â  Â  Â  Â  const m = Math.round(estimatedSTA % 1000); 
 Â  Â  Â  Â  Â  Â  Â  Â  closestSTA = `STA. ${km}km${m.toString().padStart(3, '0')}`; 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // ë””ë²„ê¹…ìš© ì½˜ì†” ì¶œë ¥ 
 Â  Â  Â  Â  Â  Â  Â  Â  console.log(`ê¸°ì¤€ì : STA.${closestPoint.sta}m (${closestPoint.x}, ${closestPoint.y})`); 
 Â  Â  Â  Â  Â  Â  Â  Â  console.log(`í´ë¦­ìœ„ì¹˜: (${clickX.toFixed(3)}, ${clickY.toFixed(3)})`); 
 Â  Â  Â  Â  Â  Â  Â  Â  console.log(`ê±°ë¦¬: ${distanceFromReference.toFixed(2)}m`); 
 Â  Â  Â  Â  Â  Â  Â  Â  console.log(`ë°©í–¥: ${isForward ? 'ì§„í–‰ë°©í–¥' : 'ë°˜ëŒ€ë°©í–¥'}`); 
 Â  Â  Â  Â  Â  Â  Â  Â  console.log(`ê³„ì‚°ëœ STA: ${estimatedSTA.toFixed(2)}m`); 
 Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  return closestSTA; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // ë ˆì´ì–´ íˆ¬ëª…ë„ ì„¤ì • (ê°œì„ ëœ ë²„ì „) 
 Â  Â  Â  Â  function setLayerOpacity(layerName, opacity) { 
 Â  Â  Â  Â  Â  Â  const layerGroup = layerGroups.get(layerName); 
 Â  Â  Â  Â  Â  Â  if (layerGroup) { 
 Â  Â  Â  Â  Â  Â  Â  Â  // ë ˆì´ì–´ ê·¸ë£¹ ë‚´ì˜ ëª¨ë“  ë ˆì´ì–´ì— íˆ¬ëª…ë„ ì ìš© 
 Â  Â  Â  Â  Â  Â  Â  Â  layerGroup.eachLayer(function(layer) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (layer.setStyle) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  layer.setStyle({ opacity: opacity }); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â  }); 
 Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // ë°œíŒŒìœ„ì¹˜ ë°ì´í„°ë¥¼ Streamlitìœ¼ë¡œ ì „ì†¡í•˜ëŠ” í•¨ìˆ˜ 
 Â  Â  Â  Â  function sendBlastingLocationsToStreamlit() { 
 Â  Â  Â  Â  Â  Â  try { 
 Â  Â  Â  Â  Â  Â  Â  Â  // í˜„ì¬ ì§€ë„ì— ìˆëŠ” ëª¨ë“  ë°œíŒŒ ë§ˆì»¤ ë°ì´í„° ìˆ˜ì§‘ 
 Â  Â  Â  Â  Â  Â  Â  Â  const blastingMarkers = window.blastingMarkers || []; 
 Â  Â  Â  Â  Â  Â  Â  Â  const locations = []; 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  blastingMarkers.forEach(marker => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (marker.blastingData) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  locations.push({ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id: marker.blastingData.id, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sta: marker.blastingData.sta, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  coordinates: marker.blastingData.coordinates, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  depth: marker.blastingData.depth, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  description: marker.blastingData.description, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  timestamp: new Date().toISOString(), 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  source: 'map' 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â  }); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  console.log('ğŸ“¤ Streamlitìœ¼ë¡œ ì „ì†¡í•  ë°œíŒŒìœ„ì¹˜ ë°ì´í„°:', locations); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // URL íŒŒë¼ë¯¸í„°ë¡œ ì „ì†¡ 
 Â  Â  Â  Â  Â  Â  Â  Â  const url = new URL(window.location); 
 Â  Â  Â  Â  Â  Â  Â  Â  url.searchParams.set('blasting_data', JSON.stringify(locations)); 
 Â  Â  Â  Â  Â  Â  Â  Â  window.history.replaceState({}, '', url); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  // Streamlit í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ìœ¼ë¡œ ë°ì´í„° ì „ë‹¬ 
 Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ë¶€ëª¨ ì°½ì´ Streamlitì¸ ê²½ìš° ìƒˆë¡œê³ ì¹¨ 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (window.parent && window.parent !== window) { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  window.parent.location.reload(); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else { 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  window.location.reload(); 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  Â  Â  Â  Â  }, 500); 
 Â  Â  Â  Â  Â  Â  Â  Â Â  
 Â  Â  Â  Â  Â  Â  Â  Â  return locations; 
 Â  Â  Â  Â  Â  Â  } catch (error) { 
 Â  Â  Â  Â  Â  Â  Â  Â  console.error('âŒ ë°œíŒŒìœ„ì¹˜ ë°ì´í„° ì „ì†¡ ì¤‘ ì˜¤ë¥˜:', error); 
 Â  Â  Â  Â  Â  Â  Â  Â  return []; 
 Â  Â  Â  Â  Â  Â  } 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // ë°œíŒŒìœ„ì¹˜ ì¶”ê°€/ì‚­ì œ ì‹œ ìë™ ë™ê¸°í™” 
 Â  Â  Â  Â  function syncBlastingLocations() { 
 Â  Â  Â  Â  Â  Â  setTimeout(() => { 
 Â  Â  Â  Â  Â  Â  Â  Â  sendBlastingLocationsToStreamlit(); 
 Â  Â  Â  Â  Â  Â  }, 100); 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // ê¸°ì¡´ ë°œíŒŒìœ„ì¹˜ ì¶”ê°€ í•¨ìˆ˜ì— ë™ê¸°í™” ì¶”ê°€ 
 Â  Â  Â  Â  const originalAddBlastingMarker = window.addBlastingMarker; 
 Â  Â  Â  Â  if (originalAddBlastingMarker) { 
 Â  Â  Â  Â  Â  Â  window.addBlastingMarker = async function(latlng) { 
 Â  Â  Â  Â  Â  Â  Â  Â  const result = await originalAddBlastingMarker(latlng); 
 Â  Â  Â  Â  Â  Â  Â  Â  syncBlastingLocations(); 
 Â  Â  Â  Â  Â  Â  Â  Â  return result; 
 Â  Â  Â  Â  Â  Â  }; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // ë°œíŒŒìœ„ì¹˜ ì‚­ì œ ì‹œì—ë„ ë™ê¸°í™” 
 Â  Â  Â  Â  const originalRemoveBlastingMarker = window.removeBlastingMarker; 
 Â  Â  Â  Â  if (originalRemoveBlastingMarker) { 
 Â  Â  Â  Â  Â  Â  window.removeBlastingMarker = function(marker) { 
 Â  Â  Â  Â  Â  Â  Â  Â  const result = originalRemoveBlastingMarker(marker); 
 Â  Â  Â  Â  Â  Â  Â  Â  syncBlastingLocations(); 
 Â  Â  Â  Â  Â  Â  Â  Â  return result; 
 Â  Â  Â  Â  Â  Â  }; 
 Â  Â  Â  Â  } 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ë™ê¸°í™” 
 Â  Â  Â  Â  window.addEventListener('load', function() { 
 Â  Â  Â  Â  Â  Â  setTimeout(syncBlastingLocations, 1000); 
 Â  Â  Â  Â  }); 
 Â  Â  Â  Â Â  
 Â  Â  Â  Â  // ì£¼ê¸°ì  ë™ê¸°í™” (5ì´ˆë§ˆë‹¤) 
 Â  Â  Â  Â  setInterval(syncBlastingLocations, 5000); 
 Â  Â  </script> 
 </body> 
 </html>
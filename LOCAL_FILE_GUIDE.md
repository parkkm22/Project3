# 로컬 파일 시스템 시공관리도 관리 가이드

## 📁 **로컬 파일 구조**

### **폴더 구조**
```
project5/
├── static/
│   └── management-drawings/
│       ├── 20240801-도림사거리정거장_미들슬라브.pdf
│       ├── 20240801-신풍정거장_시공관리도.pdf
│       ├── 20240801-신풍 환승통로_터널.pdf
│       └── ...
├── pages/
│   └── main.py
└── ...
```

## 🚀 **사용 방법**

### **1단계: 파일 업로드**
1. **사이드바** → **📋 시공관리도 업로드** 클릭
2. **공정명** 입력: `도림사거리 정거장`
3. **도면 유형** 선택: `미들슬라브`
4. **해당 월** 입력: `2024-08`
5. **파일 선택**: PDF 파일 업로드
6. **📤 시공관리도 업로드** 버튼 클릭

### **2단계: 파일명 규칙**
업로드된 파일은 다음 형식으로 자동 저장됩니다:
```
YYYYMMDD-공정명_도면유형.pdf
```

**예시:**
- `20240801-도림사거리정거장_미들슬라브.pdf`
- `20240801-신풍정거장_시공관리도.pdf`
- `20240801-신풍 환승통로_터널.pdf`

### **3단계: 파일 목록 확인**
1. **사이드바** → **📋 시공관리도 목록 조회** 클릭
2. 업로드된 모든 파일 목록 확인

## 🎯 **공정 분석 테스트**

### **테스트 질문**
- "도림사거리 정거장 미들슬라브 공정 분석해줘"
- "신풍 정거장 시공관리도 보여줘"
- "본선 1구간 공정 분석해줘"

### **예상 결과**
1. **공정 분석 테이블** 표시
2. **간트차트** 생성
3. **관련 시공관리도** 자동 표시
4. **PDF 다운로드 버튼** 제공

## 📋 **파일명 매핑 규칙**

### **공정명 추출**
파일명에서 공정명을 자동으로 추출합니다:
- `도림사거리정거장` → `도림사거리 정거장`
- `신풍정거장` → `신풍 정거장`
- `신풍 환승통로` → `신풍 환승통로`

### **도면 유형 추출**
파일명에서 도면 유형을 자동으로 추출합니다:
- `미들슬라브` → `미들슬라브`
- `시공관리도` → `시공관리도`
- `터널` → `터널`

## 🔍 **파일 검색 로직**

### **공정명 매칭**
- 사용자 질문에서 공정명 키워드 추출
- 파일명에 해당 키워드가 포함된 파일 검색
- 부분 일치 지원 (대소문자 무시)

### **도면 유형 매칭**
- 사용자 질문에서 도면 유형 키워드 추출
- 해당 유형의 도면 우선 표시

### **월별 매칭**
- 해당 월의 도면 우선 표시
- 해당 월에 도면이 없으면 가장 가까운 월의 도면 표시

## 💡 **장점**

### **로컬 파일 시스템의 장점**
1. **간단한 설정**: Supabase Storage 설정 불필요
2. **빠른 접근**: 네트워크 지연 없음
3. **안정성**: 인터넷 연결 불필요
4. **보안**: 로컬에서만 파일 관리
5. **비용**: 추가 비용 없음

### **자동화 기능**
1. **폴더 자동 생성**: `static/management-drawings` 폴더 자동 생성
2. **파일명 자동 생성**: 날짜-공정명 형식으로 자동 저장
3. **메타데이터 자동 추출**: 파일명에서 정보 자동 파싱
4. **다운로드 버튼 자동 생성**: Streamlit 다운로드 버튼 제공

## ⚠️ **주의사항**

### **파일명 규칙**
- 파일명에 공백이나 특수문자 사용 가능
- 한글 파일명 지원
- 파일명에서 공정명과 도면 유형을 구분하기 위해 `_` 사용

### **파일 크기**
- 대용량 파일 업로드 가능
- 메모리 사용량 고려하여 적절한 크기 권장

### **백업**
- `static/management-drawings` 폴더 정기 백업 권장
- 중요한 시공관리도는 별도 보관

## 🛠️ **문제 해결**

### **파일을 찾을 수 없는 경우**
1. 파일명에 공정명이 포함되어 있는지 확인
2. 파일이 `static/management-drawings` 폴더에 있는지 확인
3. 파일 확장자가 `.pdf`인지 확인

### **업로드 실패**
1. 파일 권한 확인
2. 디스크 공간 확인
3. 파일이 손상되지 않았는지 확인

### **다운로드 실패**
1. 파일이 실제로 존재하는지 확인
2. 파일 경로가 올바른지 확인
3. 파일 권한 확인

## 🎯 **테스트 시나리오**

### **시나리오 1: 기본 업로드 및 조회**
1. 시공관리도 파일 업로드
2. 파일 목록 조회
3. 공정 분석 질문
4. 시공관리도 자동 표시 확인

### **시나리오 2: 여러 파일 관리**
1. 여러 공정의 시공관리도 업로드
2. 각 공정별 분석 테스트
3. 관련 시공관리도 자동 매칭 확인

### **시나리오 3: 월별 관리**
1. 다른 월의 시공관리도 업로드
2. 특정 월 요청 시 가장 가까운 도면 표시 확인
3. 월별 도면 관리 기능 확인


# 공정 상세 분석 기능 가이드

## 🎯 **구현된 기능**

### **3단계 상세 분석 시스템**

1. **📊 공사 실적** - construction_status 테이블에서 데이터 추출
2. **🔧 상세 분석** - work_content 테이블에서 키워드 분석
3. **👥 투입 인원/장비** - personnel_data, equipment_data에서 정보 추출

## 🚀 **사용 방법**

### **테스트 질문**
```
도림사거리 정거장 미들슬라브 공정 상세히 분석해줘
```

### **예상 결과**

#### **1. 📊 공사 실적**
| 구분 | 진도율 | 완료율 | 진행상황 | 비고 |
|------|--------|--------|----------|------|
| 도림사거리 정거장 미들슬라브 | 85% | 75% | 진행중 | 정상진행 |

#### **2. 🔧 상세 분석**
| 구분 | 함치 | 내용 | 시작일 | 종료일 | 기간 |
|------|------|------|--------|--------|------|
| 5.도림사거리정거장 - 1)정거장 터널 | 3span | 철근, 거푸집 조립 | 2026-06-01 | 2026-06-15 | 14 |
| 5.도림사거리정거장 - 1)정거장 터널 | 3span | 콘크리트 타설 | 2026-06-16 | 2026-06-17 | 1 |

#### **3. 👥 투입 인원/장비**

**3-1. 투입 인원**
| 직종 | 투입인원 | 단위 |
|------|----------|------|
| 연수생 | 5 | 명 |
| 화약주임 | 2 | 명 |
| 터널공 | 8 | 명 |

**3-2. 투입 장비**
| 장비종류 | 투입대수 | 단위 |
|----------|----------|------|
| 굴착기 | 2 | 대 |
| 덤프트럭 | 3 | 대 |
| 크레인 | 1 | 대 |

## 🔧 **기술적 구현**

### **1. 데이터 검색 로직**
```python
# 상세 분석 요청 감지
is_detailed_analysis = any(keyword in response_text for keyword in [
    "상세", "상세히", "상세분석", "상세 분석", "상세히 분석", "공정 상세", "공정 상세히"
]) and is_process_analysis

# 3개 테이블에서 동시 검색
- construction_status_detailed: 공사 실적 데이터
- work_content_detailed_analysis: 상세 분석 데이터  
- personnel_data_detailed: 투입 인원 데이터
- equipment_data_detailed: 투입 장비 데이터
```

### **2. 구조화된 응답 형식**
```json
{
    "is_detailed_analysis": true,
    "detailed_analysis": {
        "construction_progress": {
            "headers": ["구분", "진도율", "완료율", "진행상황", "비고"],
            "rows": [...]
        },
        "work_details": {
            "headers": ["구분", "함치", "내용", "시작일", "종료일", "기간"],
            "rows": [...]
        },
        "personnel_equipment": {
            "personnel": {
                "headers": ["직종", "투입인원", "단위"],
                "rows": [...]
            },
            "equipment": {
                "headers": ["장비종류", "투입대수", "단위"],
                "rows": [...]
            }
        }
    }
}
```

### **3. UI 표시 로직**
- **3개 섹션으로 구분**: 공사 실적, 상세 분석, 투입 인원/장비
- **2열 레이아웃**: 투입 인원과 장비를 나란히 표시
- **테이블 형태**: 각 섹션별로 적절한 테이블 구조

## 📋 **키워드 매칭**

### **공정 분석 키워드**
- `정거장`, `미들슬라브`, `교차로`, `사거리`
- `콘크리트`, `타설`, `슬래브`, `슬라브`

### **상세 분석 키워드**
- `상세`, `상세히`, `상세분석`, `상세 분석`
- `상세히 분석`, `공정 상세`, `공정 상세히`

## 🎯 **테스트 시나리오**

### **시나리오 1: 기본 상세 분석**
```
질문: "도림사거리 정거장 미들슬라브 공정 상세히 분석해줘"
결과: 3단계 섹션으로 구분된 상세 분석 표시
```

### **시나리오 2: 다른 공정 상세 분석**
```
질문: "신풍 정거장 공정 상세 분석해줘"
결과: 신풍 정거장 관련 3단계 상세 분석 표시
```

### **시나리오 3: 일반 공정 분석 (상세 아님)**
```
질문: "도림사거리 정거장 미들슬라브 공정 분석해줘"
결과: 기존 간단한 공정 분석 + 시공상세도 표시
```

## 💡 **장점**

### **1. 체계적인 분석**
- 3단계로 구분된 명확한 분석 구조
- 각 단계별로 적절한 데이터 표시

### **2. 포괄적인 정보**
- 공사 실적, 상세 작업, 인력/장비 정보를 한 번에 제공
- 관련된 모든 정보를 종합적으로 분석

### **3. 사용자 친화적**
- 섹션별로 명확하게 구분된 표시
- 직관적인 테이블 형태로 정보 제공

## 🚀 **실행 방법**

### **1. 애플리케이션 실행**
```bash
streamlit run pages/main.py
```

### **2. 테스트 질문 입력**
```
도림사거리 정거장 미들슬라브 공정 상세히 분석해줘
```

### **3. 결과 확인**
- 3단계 섹션으로 구분된 상세 분석 표시
- 각 섹션별 테이블 데이터 확인
- 시공상세도 자동 표시 (있는 경우)

## 🎉 **완성된 기능**

✅ **3단계 상세 분석**: 공사 실적, 상세 분석, 투입 인원/장비
✅ **키워드 매칭**: 상세 분석 요청 자동 감지
✅ **구조화된 표시**: 섹션별로 구분된 테이블 표시
✅ **포괄적 데이터**: 관련된 모든 정보를 종합적으로 분석
✅ **사용자 친화적**: 직관적이고 명확한 정보 제공

이제 "공정 상세히 분석해달라"는 요청이 오면 3단계로 구분된 완전한 상세 분석을 제공합니다! 🚀

